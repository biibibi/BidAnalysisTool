<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìã ÊäïÊ†áÊñá‰ª∂ÂêàËßÑÊÄßÊ£ÄÊµã - BidAnalysis Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
    <link rel="icon" href="../static/icon/Unicom1.png" type="image/png">
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1d4ed8;
            --accent-color: #3b82f6;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #06b6d4;
            --light-bg: #f8fafc;
            --border-color: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 10px 25px rgba(0, 0, 0, 0.1);
            --card-hover-shadow: 0 8px 25px rgba(0, 0, 0, 0.15), 0 20px 40px rgba(0, 0, 0, 0.12);
        }

        /* Á¥´Ëâ≤‰∏ªÈ¢ò */
        [data-theme="purple"] {
            --primary-color: #7c3aed;
            --secondary-color: #6d28d9;
            --accent-color: #8b5cf6;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #06b6d4;
            --light-bg: #faf7ff;
            --border-color: #e9d5ff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
        }

        /* ÁªøËâ≤‰∏ªÈ¢ò */
        [data-theme="green"] {
            --primary-color: #059669;
            --secondary-color: #047857;
            --accent-color: #10b981;
            --success-color: #22c55e;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #06b6d4;
            --light-bg: #f0fdf4;
            --border-color: #d1fae5;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
        }

        /* Ê©ôËâ≤‰∏ªÈ¢ò */
        [data-theme="orange"] {
            --primary-color: #ea580c;
            --secondary-color: #c2410c;
            --accent-color: #f97316;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #06b6d4;
            --light-bg: #fff7ed;
            --border-color: #fed7aa;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
        }

        /* Ê∑±Ëâ≤‰∏ªÈ¢ò */
        [data-theme="dark"] {
            --primary-color: #3b82f6;
            --secondary-color: #2563eb;
            --accent-color: #60a5fa;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #06b6d4;
            --light-bg: #1f2937;
            --border-color: #374151;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
        }
        
        body {
            background: linear-gradient(135deg, var(--light-bg) 0%, #f1f5f9 100%);
            min-height: 100vh;
            padding: 0.5rem 0.5rem 50px 0.5rem;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            position: relative;
            overflow-x: hidden;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        /* Ê∑±Ëâ≤‰∏ªÈ¢òËÉåÊôØ */
        [data-theme="dark"] body {
            background: linear-gradient(135deg, #111827 0%, #1f2937 100%);
        }

        /* È°∂ÈÉ®Â∑•ÂÖ∑Ê†èÊ†∑Âºè */
        .top-toolbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--border-color);
            padding: 8px 20px;
            z-index: 1002;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        [data-theme="dark"] .top-toolbar {
            background: rgba(31, 41, 55, 0.95);
            border-bottom-color: #374151;
        }

        .toolbar-button {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .toolbar-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .theme-panel {
            position: relative;
        }

        .theme-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            display: none;
            min-width: 200px;
            margin-top: 5px;
        }

        [data-theme="dark"] .theme-dropdown {
            background: rgba(31, 41, 55, 0.98);
            border-color: #374151;
        }

        .theme-dropdown.show {
            display: block;
            animation: fadeInDown 0.3s ease-out;
        }

        .theme-dropdown-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .theme-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .theme-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
        }

        .theme-item:hover {
            background: rgba(37, 99, 235, 0.05);
        }

        .theme-color-preview {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            border: 2px solid transparent;
            margin-bottom: 5px;
            transition: all 0.3s ease;
        }

        .theme-item.active .theme-color-preview {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }

        .theme-name {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-align: center;
        }

        .theme-item.active .theme-name {
            color: var(--primary-color);
            font-weight: 600;
        }

        /* ‰∏ªÈ¢òËâ≤ÂΩ©ÂÆö‰πâ */
        .color-blue { background: linear-gradient(135deg, #2563eb, #1d4ed8); }
        .color-purple { background: linear-gradient(135deg, #7c3aed, #6d28d9); }
        .color-green { background: linear-gradient(135deg, #059669, #047857); }
        .color-orange { background: linear-gradient(135deg, #ea580c, #c2410c); }
        .color-dark { background: linear-gradient(135deg, #374151, #1f2937); }

        /* ÁßªÂä®Á´ØÈÄÇÈÖç */
        @media (max-width: 768px) {
            .top-toolbar {
                padding: 6px 15px;
                gap: 10px;
            }
            
            .toolbar-button {
                padding: 6px 10px;
                font-size: 0.75rem;
            }
            
            .theme-dropdown {
                right: -10px;
                min-width: 180px;
            }
            
            .theme-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
        }
        
        /* Ê∑ªÂä†ÂçäÈÄèÊòéËÉåÊôØÂõæÁâá */
        body::before {
            content: '';
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            height: 600px;
            background-image: url('../static/icon/Unicom1.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            opacity: 0.08;
            z-index: -1;
            pointer-events: none;
        }
        
        .container {
            max-width: 1200px;
            position: relative;
            z-index: 1;
            margin-top: 40px; /* ÂáèÂ∞ëÈ°∂ÈÉ®Èó¥Ë∑ùÔºåÂè™Áïô40px */
        }
        
        .header {
            position: fixed;
            top: 20px; /* Âú®Â∑•ÂÖ∑Ê†è‰∏ãÊñπ */
            left: 0;
            right: 0;
            background: linear-gradient(135deg, 
                rgba(67, 97, 238, 0.95) 0%, 
                rgba(63, 55, 201, 0.95) 50%, 
                rgba(67, 97, 238, 0.95) 100%);
            backdrop-filter: blur(15px);
            border-bottom: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px 20px 0 0; /* Ê∑ªÂä†Â∫ïÈÉ®ÂúÜËßíÊïàÊûú */
            padding: 12px 30px;
            z-index: 1000;
            animation: fadeInDown 1s ease-out;
            box-shadow: 0 4px 25px rgba(67, 97, 238, 0.2);
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.1), 
                transparent);
            animation: headerShine 3s ease-in-out infinite;
        }
        
        .header h1 {
            color: white;
            font-weight: 700;
            margin: 0;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 12px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
            flex: 1;
            justify-content: center;
            z-index: 2;
        }
        
        .header h1 i {
            color: white;
            font-size: 1.6rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .card {
            border: none;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            overflow: hidden;
            margin-bottom: 2rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            animation: fadeInUp 0.8s ease-out;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--card-hover-shadow);
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem 2rem;
            border-bottom: none;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.25);
        }
        
        .card-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .card:hover .card-header::before {
            left: 100%;
        }
        
        .card-header h3 {
            margin: 0;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3rem;
        }
        
        .card-body {
            padding: 0;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 0 0 16px 16px;
            overflow: hidden;
        }
        
        /* Â∫üÊ†áÈ°πÂç°ÁâáÊ†∑Âºè */
        .violation-item {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(67, 97, 238, 0.1);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .violation-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary-color);
            transition: width 0.3s ease;
        }
        
        .violation-item:hover {
            transform: translateX(8px);
            box-shadow: 0 8px 25px rgba(67, 97, 238, 0.15);
            border-color: var(--primary-color);
        }
        
        .violation-item:hover::before {
            width: 8px;
        }
        
        .violation-header {
            display: flex;
            justify-content: between;
            align-items: flex-start;
            margin-bottom: 1rem;
            gap: 1rem;
        }
        
        .violation-info {
            flex: 1;
        }
        
        .violation-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #343a40;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .violation-category {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        
        .category-qualification {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            color: #1976d2;
        }
        
        .category-technical {
            background: linear-gradient(135deg, #f3e5f5, #e1bee7);
            color: #7b1fa2;
        }
        
        .category-commercial {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            color: #388e3c;
        }
        
        .category-format {
            background: linear-gradient(135deg, #faf9f7, #f5f2ed);
            color: #8d6e63;
        }
        
        .category-time {
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
            color: #d32f2f;
        }
        
        .category-other {
            background: linear-gradient(135deg, #f3e5f5, #e1bee7);
            color: #7b1fa2;
        }
        
        .violation-description {
            color: #6c757d;
            line-height: 1.6;
            margin-bottom: 1rem;
        }
        
        .violation-requirement {
            background: rgba(67, 97, 238, 0.05);
            border-left: 3px solid var(--primary-color);
            padding: 0.8rem 1rem;
            border-radius: 0 8px 8px 0;
            margin-bottom: 1rem;
            font-size: 0.95rem;
        }
        
        .violation-actions {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn-detect {
            background: linear-gradient(135deg, var(--analyze-color), #5a189a);
            color: white;
            border: none;
            padding: 0.6rem 1.5rem;
            border-radius: 25px;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(114, 9, 183, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .btn-detect::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-detect:hover::before {
            left: 100%;
        }
        
        .btn-detect:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(114, 9, 183, 0.4);
            color: white;
        }
        
        .btn-detect:disabled {
            background: linear-gradient(135deg, #cccccc, #999999);
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .detection-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .status-pending {
            color: #6c757d;
        }
        
        .status-detecting {
            color: var(--warning-color);
        }
        
        .status-compliant {
            color: var(--success-color);
        }
        
        .status-violation {
            color: var(--danger-color);
        }
        
        .status-warning {
            color: var(--warning-color);
        }
        
        /* AIÊ£ÄÊµãÁªìÊûúÂå∫Âüü */
        .ai-result-section {
            margin-top: 2rem;
            padding: 1.5rem;
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border-radius: 15px;
            border-left: 5px solid var(--analyze-color);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            display: none;
            animation: fadeIn 0.6s ease;
        }
        
        .ai-result-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 1.5rem;
            color: var(--analyze-color);
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .ai-result-content {
            background: rgba(255, 255, 255, 0.8);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }
        
        .result-item {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 10px;
            border-left: 4px solid;
        }
        
        .result-compliant {
            background: rgba(76, 201, 240, 0.1);
            border-left-color: var(--success-color);
        }
        
        .result-violation {
            background: rgba(247, 37, 133, 0.1);
            border-left-color: var(--danger-color);
        }
        
        .result-warning {
            background: rgba(255, 193, 7, 0.1);
            border-left-color: var(--warning-color);
        }
        
        .result-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .result-description {
            color: #6c757d;
            line-height: 1.6;
        }
        
        /* ËøîÂõûÊåâÈíÆ */
        .back-button {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 25px;
            font-weight: 500;
            font-size: 0.9rem;
            box-shadow: 0 2px 10px rgba(67, 97, 238, 0.3);
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }
        
        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.4);
            color: white;
            text-decoration: none;
        }
        
        /* ËøõÂ∫¶ÊåáÁ§∫Âô® */
        .progress-indicator {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border: 1px solid rgba(67, 97, 238, 0.1);
        }
        
        .progress-stats {
            display: flex;
            justify-content: space-around;
            text-align: center;
            margin-top: 1rem;
        }
        
        .stat-item {
            flex: 1;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .stat-pending .stat-number { color: #6c757d; }
        .stat-compliant .stat-number { color: var(--success-color); }
        .stat-violation .stat-number { color: var(--danger-color); }
        .stat-warning .stat-number { color: var(--warning-color); }
        
        /* Âä®ÁîªÊïàÊûú */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes slideIn {
            from { 
                opacity: 0; 
                transform: translateX(100%); 
            }
            to { 
                opacity: 1; 
                transform: translateX(0); 
            }
        }
        
        .spinner {
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        
        /* È°µËÑöÊ†∑Âºè */
        .page-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(67, 97, 238, 0.1);
            padding: 8px 20px;
            text-align: center;
            font-size: 0.85rem;
            color: #6c757d;
            z-index: 999;
        }
        
        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .container {
                max-width: 100%;
                padding: 0 1rem;
            }
            
            .header h1 {
                font-size: 1.2rem;
            }
            
            .header {
                padding: 10px 15px;
                gap: 10px;
            }
            
            .header h1 i {
                font-size: 1.1rem;
            }
            
            .back-button {
                padding: 6px 12px;
                font-size: 0.75rem;
                gap: 4px;
            }
            
            .back-button span {
                display: none; /* Âú®ÁßªÂä®Á´ØÈöêËóè"ËøîÂõû‰∏ªÈ°µ"ÊñáÂ≠óÔºåÂè™ÊòæÁ§∫ÂõæÊ†á */
            }
            
            .violation-header {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .violation-actions {
                justify-content: stretch;
            }
            
            .btn-detect {
                flex: 1;
                min-width: 120px;
            }
            
            .progress-stats {
                flex-direction: column;
                gap: 1rem;
            }
            
            .page-footer {
                font-size: 0.75rem;
                padding: 6px 10px;
            }
        }
        
        /* Ë°®Ê†ºÊ†∑Âºè */
        
        .table {
            margin-bottom: 0;
            font-size: 0.85rem;
            border-radius: 0 0 16px 16px;
            overflow: hidden;
            border: 2px solid var(--border-color);
            table-layout: fixed; /* Âõ∫ÂÆöË°®Ê†ºÂ∏ÉÂ±ÄÔºåÊèêÈ´òÊ∏≤ÊüìÊÄßËÉΩ */
            width: 100%;
        }
        
        .table thead {
            border-bottom: 3px solid var(--border-color);
            position: sticky; /* Á≤òÊÄßË°®Â§¥ */
            top: 0;
            z-index: 10;
        }
        
        .table th {
            background: white;
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            font-weight: 600;
            padding: 0.7rem 0.5rem;
            font-size: 0.85rem;
            text-align: center;
            vertical-align: middle;
            white-space: nowrap;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        /* Á°Æ‰øùÊìç‰ΩúÂàó‰∏ç‰ºöË£ÅÂâ™ÊàñÈöêËóèÊåâÈíÆÔºàÁ¨¨6ÂàóÔºöÊìç‰ΩúÔºâ */
        .table td:nth-child(6) {
            overflow: visible !important;
            white-space: normal !important;
        }

        /* Êìç‰ΩúÊåâÈíÆÂÆπÂô®‰∏éÊåâÈíÆ‰øùËØÅÂèØËßÅ‰∏éÂç†‰Ωç */
        .table td:nth-child(6) .btn,
        .table td:nth-child(6) .btn-run-check {
            display: inline-flex !important;
            align-items: center;
            justify-content: center;
            visibility: visible !important;
        }
        
        .table th:first-child {
            border-top-left-radius: 0;
            border-left: 2px solid var(--border-color);
        }
        
        .table th:last-child {
            border-top-right-radius: 0;
            border-right: 2px solid var(--border-color);
        }
        
        .table td {
            padding: 0.5rem 0.4rem;
            vertical-align: middle;
            border-top: 1px solid var(--border-color);
            font-size: 0.8rem;
            color: var(--text-primary);
        }
        
        .table tbody tr:hover {
            background-color: rgba(37, 99, 235, 0.04);
        }
        
        .check-category {
            padding: 0.15rem 0.4rem;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 500;
            display: inline-block;
            white-space: nowrap;
            text-align: center;
        }
        
        .check-title {
            font-weight: 600;
            color: #343a40;
            font-size: 0.8rem;
            margin-bottom: 0.1rem;
            line-height: 1.3;
        }
        
        .check-description {
            color: #6c757d;
            font-size: 0.75rem;
            line-height: 1.3;
        }
        
        .btn-run-check {
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: white;
            border: none;
            padding: 0.25rem 0.6rem;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.75rem;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .btn-run-check.btn-sm {
            padding: 0.2rem 0.5rem;
            border-radius: 6px;
            font-size: 0.72rem;
        }

        /* Êü•ÁúãÁªìÊûúÊåâÈíÆ - ËìùËâ≤‰∏ªÈ¢ò */
        .btn-view-result {
            background: linear-gradient(135deg, var(--primary-color), #1d4ed8);
            color: white;
            border: none;
            padding: 0.2rem 0.5rem;
            border-radius: 6px;
            font-weight: 500;
            font-size: 0.72rem;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .btn-view-result:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .btn-view-result:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
        }

        /* ÈáçÊñ∞Ê£ÄÊµãÊåâÈíÆ - Ê©ôËâ≤‰∏ªÈ¢òÔºåË°®Á§∫ÈáçÁΩÆÊìç‰Ωú */
        .btn-recheck {
            background: linear-gradient(135deg, var(--warning-color), #ea580c);
            color: white;
            border: none;
            padding: 0.25rem 0.6rem;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.75rem;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .btn-recheck:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(251, 146, 60, 0.3);
        }

        .btn-recheck:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
        }

        /* ÂÖºÂÆπ‰øÆÂ§çÔºöBootstrap 5 Â∞Ü .btn-check Áî®‰∫éÈöêËóèÁöÑÂàáÊç¢ËæìÂÖ•Ôºå‰ºöËÆæÁΩÆË£ÅÂâ™/ÁªùÂØπÂÆö‰ΩçÂØºËá¥‰∏çÂèØËßÅ„ÄÇ
           Êàë‰ª¨Âú®Ê≠§Â∞ÜÂÖ∂Áî®‰∫éÂèØËßÅÊåâÈíÆÔºåÂõ†Ê≠§ÈáçÁΩÆËøô‰∫õÈöêËóèÁõ∏ÂÖ≥Â±ûÊÄß„ÄÇ*/
        .btn.btn-run-check,
        .btn.btn-view-result,
        .btn.btn-recheck {
            position: static !important;
            clip: auto !important;
            -webkit-clip-path: none !important;
            clip-path: none !important;
            width: auto !important;
            height: auto !important;
            margin: 0 !important;
            overflow: visible !important;
            white-space: nowrap !important;
        }
        
        .btn-run-check:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        
        .btn-run-check:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
        }

        /* Â∑•ÂÖ∑Á±ªÔºöÁ°Æ‰øùÂÖÉÁ¥†ÂèØËßÅ‰∏îÂç†‰Ωç */
        .ensure-visible {
            display: inline-flex !important;
            visibility: visible !important;
        }
        
        /* Áªü‰∏ÄÊìç‰ΩúÊåâÈíÆÊ†∑ÂºèÁî± .btn-run-check ÊéßÂà∂ */
        
        .status-badge {
            padding: 0.15rem 0.4rem;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 500;
            white-space: nowrap;
            display: inline-block;
            text-align: center;
        }
        
        .status-pending {
            background: var(--light-bg);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }
        
        .status-checking {
            background: linear-gradient(135deg, var(--warning-color), #e97f0b);
            color: white;
        }
        
        .status-pass {
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: white;
        }
        
        .status-fail {
            background: linear-gradient(135deg, var(--danger-color), #dc2626);
            color: white;
        }
        
        .result-cell {
            max-width: 120px;
            word-wrap: break-word;
            font-size: 0.75rem;
            line-height: 1.3;
        }
        
        .serial-number {
            font-weight: 600;
            color: var(--primary-color);
            text-align: center;
        }

        /* ÊâπÈáèÊìç‰ΩúÊåâÈíÆ */
        .batch-actions {
            text-align: center;
            margin: 2rem 0;
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap; /* ÂìçÂ∫îÂºèÊç¢Ë°å */
        }
        
        .btn-batch {
            background: linear-gradient(135deg, var(--success-color), #38b000);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.4s ease;
            box-shadow: 0 6px 20px rgba(76, 201, 240, 0.3);
            flex: 0 1 auto; /* ÂºπÊÄßÂ∏ÉÂ±Ä */
            min-width: 200px; /* ÊúÄÂ∞èÂÆΩÂ∫¶ */
        }
        
        .btn-batch:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(76, 201, 240, 0.4);
            color: white;
        }
        
        .btn-batch:disabled {
            background: linear-gradient(135deg, #cccccc, #999999);
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* ÁßªÂä®Á´ØÊâπÈáèÊìç‰ΩúÊåâÈíÆË∞ÉÊï¥ */
        @media (max-width: 768px) {
            .batch-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .btn-batch {
                width: 100%;
                max-width: 300px;
                font-size: 1rem;
                padding: 0.8rem 1.5rem;
            }
        }
    </style>
</head>

<body>
    <!-- È°∂ÈÉ®Â∑•ÂÖ∑Ê†è -->
    <div class="top-toolbar">
        <div class="theme-panel">
            <button class="toolbar-button" id="themeToggle">
                <i class="bi bi-palette"></i> ‰∏ªÈ¢ò
            </button>
            <div class="theme-dropdown" id="themeDropdown">
                <div class="theme-dropdown-title">
                    <i class="bi bi-palette"></i> ÈÄâÊã©‰∏ªÈ¢ò
                </div>
                <div class="theme-grid">
                    <div class="theme-item active" data-theme="default">
                        <div class="theme-color-preview color-blue"></div>
                        <div class="theme-name">ÈªòËÆ§ËìùËâ≤</div>
                    </div>
                    <div class="theme-item" data-theme="purple">
                        <div class="theme-color-preview color-purple"></div>
                        <div class="theme-name">È´òË¥µÁ¥´Ëâ≤</div>
                    </div>
                    <div class="theme-item" data-theme="green">
                        <div class="theme-color-preview color-green"></div>
                        <div class="theme-name">Ëá™ÁÑ∂ÁªøËâ≤</div>
                    </div>
                    <div class="theme-item" data-theme="orange">
                        <div class="theme-color-preview color-orange"></div>
                        <div class="theme-name">Ê¥ªÂäõÊ©ôËâ≤</div>
                    </div>
                    <div class="theme-item" data-theme="dark">
                        <div class="theme-color-preview color-dark"></div>
                        <div class="theme-name">Ê∑±Ëâ≤Ê®°Âºè</div>
                    </div>
                </div>
            </div>
        </div>
        <button class="toolbar-button" id="helpBtn">
            <i class="bi bi-question-circle"></i> ‰ΩøÁî®ÊåáÂçó
        </button>
    </div>

    <div class="container">
        <div class="header">
            <a href="/" class="back-button">
                <i class="bi bi-arrow-left"></i> <span>ËøîÂõû‰∏ªÈ°µ</span>
            </a>
            <h1><i class="bi bi-clipboard-check"></i> ÊäïÊ†áÊñá‰ª∂ÂêàËßÑÊÄßÊ£ÄÊµã</h1>
        </div>

        <!-- ËøõÂ∫¶ÊåáÁ§∫Âô® -->
        <div class="progress-indicator">
            <div class="progress-stats">
                <div class="stat-item stat-pending">
                    <div class="stat-number" id="pendingCount">32</div>
                    <div class="stat-label">ÂæÖÊ£ÄÊµã</div>
                </div>
                <div class="stat-item stat-compliant">
                    <div class="stat-number" id="compliantCount">0</div>
                    <div class="stat-label">ÂêàËßÑ</div>
                </div>
                <div class="stat-item stat-warning">
                    <div class="stat-number" id="warningCount">0</div>
                    <div class="stat-label">Ë≠¶Âëä</div>
                </div>
                <div class="stat-item stat-violation">
                    <div class="stat-number" id="violationCount">0</div>
                    <div class="stat-label">ËøùËßÑ</div>
                </div>
            </div>
        </div>

        <!-- ÊâπÈáèÊìç‰Ωú -->
        <div class="batch-actions">
            <button class="btn btn-batch" id="checkAllBtn">
                <i class="bi bi-check-all"></i> ‰∏ÄÈîÆÊ£ÄÊµãÂÖ®ÈÉ®
            </button>
            <button class="btn btn-batch" id="exportReportBtn" disabled>
                <i class="bi bi-download"></i> ÂØºÂá∫Ê£ÄÊµãÊä•Âëä
            </button>
        </div>

        <!-- Â∫üÊ†áÈ°πÊ£ÄÊµãÂàóË°® -->
        <div class="card">
            <div class="card-header">
                <h3><i class="bi bi-list-check"></i> Â∏∏ËßÅÂ∫üÊ†áÈ°πÊ£ÄÊµãÊ∏ÖÂçï</h3>
            </div>
            <div class="card-body">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th style="width: 10%;">Â∫èÂè∑</th>
                            <th style="width: 12%;">Á±ªÂà´</th>
                            <th style="width: 20%;">Ê£ÄÊµãÈ°πÁõÆ</th>
                            <th style="width: 25%;">Ë¶ÅÊ±ÇËØ¥Êòé</th>
                            <th style="width: 10%;">Áä∂ÊÄÅ</th>
                            <th style="width: 10%;">Êìç‰Ωú</th>
                            <th style="width: 13%;">Ê£ÄÊµãÁªìÊûú</th>
                        </tr>
                    </thead>
                    <tbody id="violationTableBody">
                        <!-- Â∫üÊ†áÈ°πÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÁîüÊàê -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- AIÁªºÂêàÊ£ÄÊµãÁªìÊûú -->
        <div class="ai-result-section" id="aiResultSection">
            <div class="ai-result-header">
                <i class="bi bi-robot"></i>
                AIÊô∫ËÉΩÂàÜÊûêÁªìÊûú
            </div>
            <div class="ai-result-content" id="aiResultContent">
                <!-- AIÂàÜÊûêÁªìÊûúÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
            </div>
        </div>
    </div>

    <script>
        // Â∏∏ËßÅÂ∫üÊ†áÈ°πÊï∞ÊçÆ - Âü∫‰∫éReferenceList.xlsxËá™Âä®ÁîüÊàêÔºàÊåâExcelÁ±ªÂà´ÂàÜÁ±ªÔºâ
        const violationItems = [
            {
                id: 'check_0_0',
                title: 'ÂêØÁî®ÊäïÊ†á‰∏ìÁî®Á´†ÁöÑÊÉÖÂÜµËØ¥Êòé',
                category: 'ËµÑË¥®Ë¶ÅÊ±Ç',
                categoryClass: 'category-qualification',
                description: 'Ê£ÄÊü•ÂêØÁî®ÊäïÊ†á‰∏ìÁî®Á´†ÁöÑÊÉÖÂÜµËØ¥Êòé',
                requirement: 'Â¶Ç‰ΩøÁî®ÊäïÊ†á‰∏ìÁî®Á´†ÔºåÂÖ≥‰∫éÂêØÁî®ÊäïÊ†á‰∏ìÁî®Á´†ÁöÑÊÉÖÂÜµËØ¥ÊòéÊòØÂê¶ÈôÑ‰∏ä',
                icon: 'bi-patch-check'
            },
            {
                id: 'check_1_1',
                title: 'È°πÁõÆÂêçÁß∞ÂèäÁºñÂè∑',
                category: 'ËµÑË¥®Ë¶ÅÊ±Ç',
                categoryClass: 'category-qualification',
                description: 'Ê£ÄÊü•È°πÁõÆÂêçÁß∞ÂèäÁºñÂè∑',
                requirement: 'È°πÁõÆÂêçÁß∞„ÄÅÈ°πÁõÆÁºñÂè∑Á≠âÂÜÖÂÆπÊòØÂê¶Ê≠£Á°Æ',
                icon: 'bi-tag'
            },
            {
                id: 'check_2_2',
                title: 'ÊéàÊùÉÂßîÊâò‰π¶',
                category: 'ËµÑË¥®Ë¶ÅÊ±Ç',
                categoryClass: 'category-qualification',
                description: 'Ê£ÄÊü•ÊéàÊùÉÂßîÊâò‰π¶',
                requirement: 'ÊéàÊùÉÂßîÊâò‰π¶ÊòØÂê¶ÈôÑ‰∏äÔºåÊéàÊùÉ‰∫∫ÂíåÊéàÊùÉÂßîÊâò‰∫∫ÁöÑË∫´‰ªΩËØÅÂè∑Á†Å„ÄÅÂßìÂêç„ÄÅÈ°πÁõÆÂêçÁß∞Á≠âÂÜÖÂÆπÊòØÂê¶Ê≠£Á°ÆÔºåÂÜÖÂÆπÊòØÂê¶ÂíåÊãõÊ†áÊñá‰ª∂Ë¶ÅÊ±Ç‰∏ÄËá¥',
                icon: 'bi-person-check'
            },
            {
                id: 'check_3_3',
                title: 'Ê≥ïÂÆö‰ª£Ë°®‰∫∫Ë∫´‰ªΩËØÅÊòé',
                category: 'ËµÑË¥®Ë¶ÅÊ±Ç',
                categoryClass: 'category-qualification',
                description: 'Ê£ÄÊü•Ê≥ïÂÆö‰ª£Ë°®‰∫∫Ë∫´‰ªΩËØÅÊòé',
                requirement: 'Ê≥ïÂÆö‰ª£Ë°®‰∫∫Ë∫´‰ªΩËØÅÊòéÊòØÂê¶ÈôÑ‰∏äÔºåÊ≥ïÂÆö‰ª£Ë°®‰∫∫ÁöÑË∫´‰ªΩËØÅÂè∑Á†Å„ÄÅÂßìÂêçÁ≠âÂÜÖÂÆπÊòØÂê¶Ê≠£Á°ÆÔºåÂÜÖÂÆπÊòØÂê¶ÂíåÊãõÊ†áÊñá‰ª∂Ë¶ÅÊ±Ç‰∏ÄËá¥',
                icon: 'bi-person-badge'
            },
            {
                id: 'check_4_4',
                title: 'ÊäïÊ†áÊâøËØ∫‰π¶',
                category: 'ËµÑË¥®Ë¶ÅÊ±Ç',
                categoryClass: 'category-qualification',
                description: 'Ê£ÄÊü•ÊäïÊ†áÊâøËØ∫‰π¶',
                requirement: 'ÊäïÊ†áÊâøËØ∫‰π¶ÊòØÂê¶ÈôÑ‰∏äÔºåÈ°πÁõÆÂêçÁß∞„ÄÅÈ°πÁõÆÁºñÂè∑Á≠âÂÜÖÂÆπÊòØÂê¶Ê≠£Á°ÆÔºåÂÜÖÂÆπÊòØÂê¶ÂíåÊãõÊ†áÊñá‰ª∂Ë¶ÅÊ±Ç‰∏ÄËá¥',
                icon: 'bi-check2-circle'
            },
            {
                id: 'check_5_5',
                title: 'ÊéàÊùÉÂßîÊâò‰∫∫Á§æ‰øùËØÅÊòé',
                category: 'ËµÑË¥®Ë¶ÅÊ±Ç',
                categoryClass: 'category-qualification',
                description: 'Ê£ÄÊü•ÊéàÊùÉÂßîÊâò‰∫∫Á§æ‰øùËØÅÊòé',
                requirement: 'ÊéàÊùÉÂßîÊâò‰∫∫Á§æ‰øùÊòØÂê¶ÂÖ∑Â§á',
                icon: 'bi-person-check'
            },
            {
                id: 'check_6_6',
                title: 'ÊéàÊùÉÂßîÊâò‰∫∫Á§æ‰øùËØÅÊòé',
                category: 'ËµÑË¥®Ë¶ÅÊ±Ç',
                categoryClass: 'category-qualification',
                description: 'Ê£ÄÊü•ÊéàÊùÉÂßîÊâò‰∫∫Á§æ‰øùËØÅÊòé',
                requirement: 'Á§æ‰øùÊâìÂç∞Êó•ÊúüÊòØÂê¶ÊúâÊïà',
                icon: 'bi-person-check'
            },
            {
                id: 'check_7_7',
                title: 'Ëê•‰∏öÊâßÁÖß',
                category: 'ËµÑË¥®Ë¶ÅÊ±Ç',
                categoryClass: 'category-qualification',
                description: 'Ê£ÄÊü•Ëê•‰∏öÊâßÁÖß',
                requirement: 'ÊÄªÈÉ®„ÄÅÁúÅÂÖ¨Âè∏„ÄÅÁªçÂÖ¥Ëê•‰∏öÊâßÁÖßÊòØÂê¶ÈôÑ‰∏äÔºåÂêÑËê•‰∏öÊâßÁÖßÊòØÂê¶Âú®ÊéàÊùÉÁöÑÊúâÊïàÊúüÂÜÖ',
                icon: 'bi-award'
            },
            {
                id: 'check_8_8',
                title: 'ÊÄªÂÖ¨Âè∏ÊéàÊùÉ',
                category: 'ËµÑË¥®Ë¶ÅÊ±Ç',
                categoryClass: 'category-qualification',
                description: 'Ê£ÄÊü•ÊÄªÂÖ¨Âè∏ÊéàÊùÉ',
                requirement: 'ÊÄªÂÖ¨Âè∏„ÄÅÁúÅÂÖ¨Âè∏ÊéàÊùÉÂáΩÊòØÂê¶ÂÖ∑Â§áÔºåÂêÑÊéàÊùÉÂáΩÊòØÂê¶Âú®ÊéàÊùÉÁöÑÊúâÊïàÊúüÂÜÖ',
                icon: 'bi-person-check'
            },
            {
                id: 'check_9_9',
                title: 'ÊäÄÊúØÊñπÊ°àÔºàÊäÄÊúØÂÅèÁ¶ªË°®Ôºâ',
                category: 'ÊäÄÊúØË¶ÅÊ±Ç',
                categoryClass: 'category-technical',
                description: 'Ê£ÄÊü•ÊäÄÊúØÊñπÊ°àÔºàÊäÄÊúØÂÅèÁ¶ªË°®Ôºâ',
                requirement: 'ÊäÄÊúØÂÅèÁ¶ªË°®ÊòØÂê¶ÈôÑ‰∏ä',
                icon: 'bi-box'
            },
            {
                id: 'check_10_10',
                title: 'ÊäÄÊúØÊñπÊ°àÔºàÊäÄÊúØÂÅèÁ¶ªË°®Ôºâ',
                category: 'ÊäÄÊúØË¶ÅÊ±Ç',
                categoryClass: 'category-technical',
                description: 'Ê£ÄÊü•ÊäÄÊúØÊñπÊ°àÔºàÊäÄÊúØÂÅèÁ¶ªË°®Ôºâ',
                requirement: 'È°πÁõÆÂêçÁß∞„ÄÅÈ°πÁõÆÁºñÂè∑ÊòØÂê¶Ê≠£Á°ÆÔºåË°®Ê†ºÊ†ºÂºèÊòØÂê¶ÂíåÊãõÊ†áÊñá‰ª∂Ë¶ÅÊ±Ç‰∏ÄËá¥',
                icon: 'bi-box'
            },
            {
                id: 'check_11_11',
                title: 'ÊäïÊ†á‰∫ßÂìÅËßÑÊ†ºÈÖçÁΩÆÊ∏ÖÂçï',
                category: 'ÊäÄÊúØË¶ÅÊ±Ç',
                categoryClass: 'category-technical',
                description: 'Ê£ÄÊü•ÊäïÊ†á‰∫ßÂìÅËßÑÊ†ºÈÖçÁΩÆÊ∏ÖÂçï',
                requirement: 'ÊòØÂê¶ÊúâË¶ÅÊ±ÇÂÆûË¥®ÊÄßÂìçÂ∫îÁöÑÈ°πÁõÆÔºå‰ª•ÂèäÂìçÂ∫îÊÉÖÂÜµÊ£ÄÊü•ÔºåÊòØÂê¶Á¨¶ÂêàÂÆûË¥®ÊÄßÂìçÂ∫îÁöÑÊãõÊ†áË¶ÅÊ±Ç',
                icon: 'bi-box'
            },
            {
                id: 'check_12_12',
                title: 'ÊäïÊ†á‰∫ßÂìÅËßÑÊ†ºÈÖçÁΩÆÊ∏ÖÂçï',
                category: 'ÊäÄÊúØË¶ÅÊ±Ç',
                categoryClass: 'category-technical',
                description: 'Ê£ÄÊü•ÊäïÊ†á‰∫ßÂìÅËßÑÊ†ºÈÖçÁΩÆÊ∏ÖÂçï',
                requirement: 'ÊäïÊ†á‰∫ßÂìÅËßÑÊ†ºÈÖçÁΩÆÊ∏ÖÂçïÊòØÂê¶ÂÖ∑Â§áÔºåÂ°´ÂÜôÊòØÂê¶ÂêàÁêÜÔºåËÆæÂ§áÊï∞ÈáèÂíåË°®Ê†ºÊ†ºÂºèÊòØÂê¶ÂíåÊãõÊ†áÊñá‰ª∂Ë¶ÅÊ±Ç‰∏ÄËá¥',
                icon: 'bi-box'
            },
            {
                id: 'check_13_13',
                title: 'ÊäïÊ†á‰∫ßÂìÅËßÑÊ†ºÈÖçÁΩÆÊ∏ÖÂçï',
                category: 'ÊäÄÊúØË¶ÅÊ±Ç',
                categoryClass: 'category-technical',
                description: 'Ê£ÄÊü•ÊäïÊ†á‰∫ßÂìÅËßÑÊ†ºÈÖçÁΩÆÊ∏ÖÂçï',
                requirement: 'ÊòØÂê¶ÊúâË¶ÅÊ±ÇÂÆûË¥®ÊÄßÂìçÂ∫îÁöÑÈ°πÁõÆÔºåÂ¶ÇÊúâËØ•È°πÁõÆÁöÑÂÖ∑‰ΩìÂèÇÊï∞ÂíåËØÅÊòéÊùêÊñôÊòØÂê¶ÈôÑ‰∏ä‰∏îÁ¨¶Âêà',
                icon: 'bi-box'
            },
            {
                id: 'check_14_14',
                title: '‰∫ßÂìÅÊ£ÄÊµãÊä•Âëä„ÄÅÂΩ©È°µÁ≠â',
                category: 'ÊäÄÊúØË¶ÅÊ±Ç',
                categoryClass: 'category-technical',
                description: 'Ê£ÄÊü•‰∫ßÂìÅÊ£ÄÊµãÊä•Âëä„ÄÅÂΩ©È°µÁ≠â',
                requirement: 'ÊòØÂê¶ÊúâË¶ÅÊ±ÇÂÆûË¥®ÊÄßÂìçÂ∫îÁöÑÈ°πÁõÆÔºåÂ¶ÇÊúâËØ•È°πÁõÆÁöÑÊ£ÄÊµãÊä•ÂëäÊòØÂê¶ÂÖ∑Â§á',
                icon: 'bi-box'
            },
            {
                id: 'check_15_15',
                title: '‰∫ßÂìÅÊ£ÄÊµãÊä•Âëä„ÄÅÂΩ©È°µÁ≠â',
                category: 'ÊäÄÊúØË¶ÅÊ±Ç',
                categoryClass: 'category-technical',
                description: 'Ê£ÄÊü•‰∫ßÂìÅÊ£ÄÊµãÊä•Âëä„ÄÅÂΩ©È°µÁ≠â',
                requirement: 'Ê†∏ÂøÉËÆæÂ§áÁöÑ‰∫ßÂìÅÂΩ©È°µÁ≠âÂèÇÊï∞ËØÅÊòéÊùêÊñôÊòØÂê¶ÂÖ∑Â§á',
                icon: 'bi-box'
            },
            {
                id: 'check_16_16',
                title: 'ÊäïÊ†áÂìçÂ∫îÂáΩ',
                category: 'ÂïÜÂä°Ë¶ÅÊ±Ç',
                categoryClass: 'category-commercial',
                description: 'Ê£ÄÊü•ÊäïÊ†áÂìçÂ∫îÂáΩ',
                requirement: 'ÊäïÊ†áÂìçÂ∫îÂáΩÊòØÂê¶ÈôÑ‰∏äÔºåÂÜÖÂÆπÊòØÂê¶ÂíåÊãõÊ†áÊñá‰ª∂Ë¶ÅÊ±Ç‰∏ÄËá¥',
                icon: 'bi-file-text'
            },
            {
                id: 'check_17_17',
                title: 'ÊäïÊ†áÂìçÂ∫îÂáΩ',
                category: 'ÂïÜÂä°Ë¶ÅÊ±Ç',
                categoryClass: 'category-commercial',
                description: 'Ê£ÄÊü•ÊäïÊ†áÂìçÂ∫îÂáΩ',
                requirement: 'ÊãõÊ†áÁºñÂè∑„ÄÅÁ≠æÂ≠ó‰∫∫‰ø°ÊÅØÁ≠âÂ°´ÂÜôÂÜÖÂÆπÊòØÂê¶Ê≠£Á°Æ',
                icon: 'bi-file-text'
            },
            {
                id: 'check_18_18',
                title: 'ÂºÄÊ†á‰∏ÄËßàË°®ÂíåÂàÜÈ°πÊä•‰ª∑Ë°®',
                category: 'ÂïÜÂä°Ë¶ÅÊ±Ç',
                categoryClass: 'category-commercial',
                description: 'Ê£ÄÊü•ÂºÄÊ†á‰∏ÄËßàË°®ÂíåÂàÜÈ°πÊä•‰ª∑Ë°®',
                requirement: 'ÂïÜÂä°Êä•‰ª∑ÊòØÂê¶Ë∂ÖËøáÊãõÊ†á‰∏äÈôê‰ª∑',
                icon: 'bi-currency-dollar'
            },
            {
                id: 'check_19_19',
                title: 'ÂºÄÊ†á‰∏ÄËßàË°®ÂíåÂàÜÈ°πÊä•‰ª∑Ë°®',
                category: 'ÂïÜÂä°Ë¶ÅÊ±Ç',
                categoryClass: 'category-commercial',
                description: 'Ê£ÄÊü•ÂºÄÊ†á‰∏ÄËßàË°®ÂíåÂàÜÈ°πÊä•‰ª∑Ë°®',
                requirement: 'ÂºÄÊ†á‰∏ÄËßàË°®ÂàÜÈ°πÈáëÈ¢ùÂíåÊÄª‰ª∑ÊòØÂê¶‰∏ÄËá¥ÔºåÊÄª‰ª∑Â§ßÂ∞èÂÜôÊòØÂê¶‰∏ÄËá¥',
                icon: 'bi-currency-dollar'
            },
            {
                id: 'check_20_20',
                title: 'ÂºÄÊ†á‰∏ÄËßàË°®ÂíåÂàÜÈ°πÊä•‰ª∑Ë°®',
                category: 'ÂïÜÂä°Ë¶ÅÊ±Ç',
                categoryClass: 'category-commercial',
                description: 'Ê£ÄÊü•ÂºÄÊ†á‰∏ÄËßàË°®ÂíåÂàÜÈ°πÊä•‰ª∑Ë°®',
                requirement: 'ÂàÜÈ°πÊä•‰ª∑Ë°®ÊÄª‰ª∑ÊòØÂê¶ÂíåÂºÄÊ†á‰∏ÄËßàË°®‰∏ÄËá¥ÔºåÂÖ∑‰ΩìÁªÜÈ°πÈáëÈ¢ùÊ£ÄÊü•',
                icon: 'bi-currency-dollar'
            },
            {
                id: 'check_21_21',
                title: 'ÂºÄÊ†á‰∏ÄËßàË°®ÂíåÂàÜÈ°πÊä•‰ª∑Ë°®',
                category: 'ÂïÜÂä°Ë¶ÅÊ±Ç',
                categoryClass: 'category-commercial',
                description: 'Ê£ÄÊü•ÂºÄÊ†á‰∏ÄËßàË°®ÂíåÂàÜÈ°πÊä•‰ª∑Ë°®',
                requirement: 'ÂàÜÈ°πÊä•‰ª∑Ë°®Ê∏ÖÂçïÂÜÖÂÆπÊòØÂê¶ÂíåÊäÄÊúØÊ†á‰∏≠ÊäïÊ†á‰∫ßÂìÅËßÑÊ†ºÈÖçÁΩÆÊ∏ÖÂçï‰∏ÄËá¥',
                icon: 'bi-currency-dollar'
            },
            {
                id: 'check_22_22',
                title: 'ÂÖ∂‰ªñÈ°πÁõÆ',
                category: 'ÂÖ∂‰ªñË¶ÅÊ±Ç',
                categoryClass: 'category-format',
                description: 'Ê£ÄÊü•ÂÖ∂‰ªñÈ°πÁõÆ',
                requirement: 'Âú®ÊãõÊ†áÊñá‰ª∂‰∏≠ÂàÜÂà´ÊêúÁ¥¢‚ÄúÊó†Êïà‚Äù„ÄÅ‚ÄúÂ∫üÊ†á‚Äù„ÄÅ‚Äú‚ñ≤‚Äù„ÄÅ‚Äú‚òÖ‚ÄùÁ≠âÂ≠óÊ†∑Ôºå‰∏éÊäïÊ†áÊñá‰ª∂‰∏Ä‰∏ÄÂØπÁÖßÊ£ÄÊü•',
                icon: 'bi-search'
            },
            {
                id: 'check_23_23',
                title: 'ÂÖ∂‰ªñÈ°πÁõÆ',
                category: 'ÂÖ∂‰ªñË¶ÅÊ±Ç',
                categoryClass: 'category-format',
                description: 'Ê£ÄÊü•ÂÖ∂‰ªñÈ°πÁõÆ',
                requirement: 'Âú®ÊãõÊ†áÊñá‰ª∂‰∏≠ÊêúÁ¥¢‚ÄúÂ∑•Êúü‚Äù„ÄÅ‚ÄúÂÆåÂ∑•‚ÄùÁ≠âÂ≠óÊ†∑ÔºåÁ°ÆËÆ§Â∑•ÊúüÔºå‰∏éÊäïÊ†áÊñá‰ª∂‰∏Ä‰∏ÄÂØπÁÖßÊ£ÄÊü•',
                icon: 'bi-search'
            },
            {
                id: 'check_24_24',
                title: 'ÂÖ∂‰ªñÈ°πÁõÆ',
                category: 'ÂÖ∂‰ªñË¶ÅÊ±Ç',
                categoryClass: 'category-format',
                description: 'Ê£ÄÊü•ÂÖ∂‰ªñÈ°πÁõÆ',
                requirement: 'Âú®ÊãõÊ†áÊñá‰ª∂‰∏≠ÊêúÁ¥¢‚ÄúË¥®‰øù‚Äù„ÄÅ‚ÄúÁª¥‰øù‚Äù„ÄÅ‚ÄúÁª¥Êä§‚ÄùÁ≠âÂ≠óÊ†∑ÔºåÁ°ÆËÆ§È°πÁõÆË¥®‰øùÊúüÂèäÁª¥Êä§ÊúüÁ≠âÔºå‰∏éÊäïÊ†áÊñá‰ª∂‰∏Ä‰∏ÄÂØπÁÖßÊ£ÄÊü•ÔºåÁ°ÆËÆ§Êó†ËØØËØ∑Á≠æÂ≠ó',
                icon: 'bi-search'
            },
            {
                id: 'check_25_25',
                title: 'ÂÖ∂‰ªñÈ°πÁõÆ',
                category: 'ÂÖ∂‰ªñË¶ÅÊ±Ç',
                categoryClass: 'category-format',
                description: 'Ê£ÄÊü•ÂÖ∂‰ªñÈ°πÁõÆ',
                requirement: 'Âú®ÊãõÊ†áÊñá‰ª∂‰∏≠ÂàÜÂà´ÊêúÁ¥¢‚ÄúÊâøËØ∫‚ÄùÂ≠óÊ†∑Êù•Êü•ÊâæÈúÄË¶ÅÊâøËØ∫ÁöÑÂÜÖÂÆπÔºå‰∏éÊäïÊ†áÊñá‰ª∂‰∏Ä‰∏ÄÂØπÁÖßÊ£ÄÊü•',
                icon: 'bi-search'
            },
            {
                id: 'check_26_26',
                title: 'ÂÖ∂‰ªñÈ°πÁõÆ',
                category: 'ÂÖ∂‰ªñË¶ÅÊ±Ç',
                categoryClass: 'category-format',
                description: 'Ê£ÄÊü•ÂÖ∂‰ªñÈ°πÁõÆ',
                requirement: 'Âú®ÊäïÊ†áÊñá‰ª∂‰∏≠ÂàÜÂà´ÊêúÁ¥¢‚ÄúÈ°πÁõÆÂêçÁß∞‚Äù„ÄÅ‚ÄúÈ°πÁõÆÁºñÂè∑‚Äù„ÄÅ‚ÄúÊãõÊ†áÁºñÂè∑‚Äù„ÄÅ‚ÄúÊäïÊ†áÂçï‰Ωç‚ÄùÁ≠âÂ≠óÊ†∑Ôºå‰∏éÊãõÊ†áÊñá‰ª∂‰∏≠ÁöÑÈ°πÁõÆÂêçÁß∞‰∏éÈ°πÁõÆÁºñÂè∑ÂØπÁÖßÊ£ÄÊü•',
                icon: 'bi-tag'
            },
            {
                id: 'check_27_27',
                title: 'ÂÖ∂‰ªñÈ°πÁõÆ',
                category: 'ÂÖ∂‰ªñË¶ÅÊ±Ç',
                categoryClass: 'category-format',
                description: 'Ê£ÄÊü•ÂÖ∂‰ªñÈ°πÁõÆ',
                requirement: 'Ê£ÄÊü•ÊäïÊ†áÊñá‰ª∂‰∏≠ÁöÑÈ°µÁúâÂèäÈ°µËÑöÔºåÈÅøÂÖçÂá∫Áé∞ÂÖ∂‰ªñÈ°πÁõÆ‰ø°ÊÅØ',
                icon: 'bi-file-earmark'
            },
            {
                id: 'check_28_28',
                title: 'ÂÖ∂‰ªñÈ°πÁõÆ',
                category: 'ÂÖ∂‰ªñË¶ÅÊ±Ç',
                categoryClass: 'category-format',
                description: 'Ê£ÄÊü•ÂÖ∂‰ªñÈ°πÁõÆ',
                requirement: 'Âú®ÊäïÊ†áÊñá‰ª∂‰∏≠ÊêúÁ¥¢ÈÉ®ÂàÜÂçï‰ΩçÂÖ≥ÈîÆËØçÔºåÈÅøÂÖçÂá∫Áé∞‰∏≤Ê†áÊÉÖÂÜµ',
                icon: 'bi-search'
            },
            {
                id: 'check_29_29',
                title: 'ÂÖ∂‰ªñÈ°πÁõÆ',
                category: 'ÂÖ∂‰ªñË¶ÅÊ±Ç',
                categoryClass: 'category-format',
                description: 'Ê£ÄÊü•ÂÖ∂‰ªñÈ°πÁõÆ',
                requirement: 'Â¶ÇÊúâÁéØ‰øù‰∏éËäÇËÉΩ‰∫ßÂìÅÔºåËäÇËÉΩËØÅ‰π¶ÊòØÂê¶Â∑≤ÈôÑ„ÄÇËäÇËÉΩ‰∫ßÂìÅÊ∏ÖÂçïÔºöhttp://www.ccgp.gov.cn/jnhb/jnhbqd/jnqd/',
                icon: 'bi-leaf'
            },
            {
                id: 'check_30_30',
                title: 'ÂÖ∂‰ªñÈ°πÁõÆ',
                category: 'ÂÖ∂‰ªñË¶ÅÊ±Ç',
                categoryClass: 'category-format',
                description: 'Ê£ÄÊü•ÂÖ∂‰ªñÈ°πÁõÆ',
                requirement: 'Â¶Ç‰Ωé‰ª∑Â∫îÊ†áÊòØÂê¶Â∑≤Êèê‰æõ‰Ωé‰ª∑ËØ¥Êòé',
                icon: 'bi-graph-down'
            },
            {
                id: 'check_31_31',
                title: 'ÂÖ∂‰ªñÈ°πÁõÆ',
                category: 'ÂÖ∂‰ªñË¶ÅÊ±Ç',
                categoryClass: 'category-format',
                description: 'Ê£ÄÊü•ÂÖ∂‰ªñÈ°πÁõÆ',
                requirement: 'ÊòØÂê¶Âá∫Áé∞Âêå‰∏ÄÊ†áÁöÑÁâ©ÊàñÊãõÊ†á‰∫ßÂìÅ(ÊúçÂä°)ÂÜÖÁöÑ‰∏ªË¶Å‰∫ßÂìÅ(ÈáçË¶ÅÁªÑÊàêÈÉ®ÂàÜ)Âá∫Áé∞ÊäÄÊúØ„ÄÅÂïÜÂä°ÊèèËø∞‰∏ç‰∏ÄËá¥ÊàñÂâçÂêéÊèèËø∞‰∏ç‰∏ÄËá¥ÁöÑÊÉÖÂÜµ',
                icon: 'bi-search'
            }
        ];

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // È°µÈù¢ÂàùÂßãÂåñ
            initializePage();
            setupEventListeners();
            initThemeSwitcher();
            // ÂàùÂßãÂåñÂÆåÊàê
        });

        // ÂàùÂßãÂåñÈ°µÈù¢
        function initializePage() {
            // ËØªÂèñ‰ªéindexÈ°µÈù¢‰º†ÈÄíÁöÑÊñá‰ª∂‰ø°ÊÅØ
            const tenderFileId = sessionStorage.getItem('tenderFileId');
            const bidFileId = sessionStorage.getItem('bidFileId');
            const tenderFileName = sessionStorage.getItem('tenderFileName');
            const bidFileName = sessionStorage.getItem('bidFileName');
            
            // Â¶ÇÊûúÊúâÊñá‰ª∂‰ø°ÊÅØÔºåÊòæÁ§∫Âú®È°µÈù¢‰∏≠
            if (tenderFileName || bidFileName) {
                updateFileInfoDisplay(tenderFileName, bidFileName);
            }
            
            renderViolationItems();
            updateProgressStats();
        }
        
        // Êõ¥Êñ∞Êñá‰ª∂‰ø°ÊÅØÊòæÁ§∫
        function updateFileInfoDisplay(tenderFileName, bidFileName) {
            // Âú®È°µÈù¢Â§¥ÈÉ®ÊàñÈÄÇÂΩì‰ΩçÁΩÆÊòæÁ§∫ÂΩìÂâçÂàÜÊûêÁöÑÊñá‰ª∂‰ø°ÊÅØ
            const headerElement = document.querySelector('.header h1');
            if (headerElement && (tenderFileName || bidFileName)) {
                let fileInfo = '';
                if (tenderFileName && bidFileName) {
                    fileInfo = ` (ÊãõÊ†áÊñá‰ª∂: ${tenderFileName}, ÊäïÊ†áÊñá‰ª∂: ${bidFileName})`;
                } else if (tenderFileName) {
                    fileInfo = ` (ÊãõÊ†áÊñá‰ª∂: ${tenderFileName})`;
                } else if (bidFileName) {
                    fileInfo = ` (ÊäïÊ†áÊñá‰ª∂: ${bidFileName})`;
                }
                
                // Ê∑ªÂä†Êñá‰ª∂‰ø°ÊÅØÂà∞Ê†áÈ¢ò‰∏≠Ôºå‰ΩÜ‰øùÊåÅÁÆÄÊ¥Å
                const originalTitle = headerElement.textContent.split(' (')[0];
                headerElement.innerHTML = `<i class="bi bi-clipboard-check"></i> ${originalTitle}`;
                
                // Âú®Ê†áÈ¢ò‰∏ãÊñπÊ∑ªÂä†Êñá‰ª∂‰ø°ÊÅØ
                if (!document.querySelector('.file-info-display')) {
                    const fileInfoDiv = document.createElement('div');
                    fileInfoDiv.className = 'file-info-display';
                    fileInfoDiv.style.cssText = 'font-size: 0.9rem; color: rgba(255,255,255,0.8); margin-top: 0.5rem;';
                    fileInfoDiv.textContent = fileInfo.substring(2); // ÂéªÊéâÂºÄÂ§¥ÁöÑÁ©∫Ê†ºÂíåÊã¨Âè∑
                    headerElement.parentElement.appendChild(fileInfoDiv);
                }
            }
        }

        // Ê∏≤ÊüìÂ∫üÊ†áÈ°πÂàóË°®
        function renderViolationItems() {
            const violationTableBody = document.getElementById('violationTableBody');
            
            if (!violationTableBody) {
                console.error('‚ùå Êâæ‰∏çÂà∞Ë°®Ê†ºbodyÂÖÉÁ¥†ÔºÅ');
                return;
            }
            
            // Ê∏ÖÁ©∫Ë°®Ê†ºÂÜÖÂÆπ
            violationTableBody.innerHTML = '';
            
            violationItems.forEach((item, index) => {
                // ‰∏∫È°πÁõÆ‰ø°ÊÅØÊ£ÄÊµãÈ°πÁîüÊàêÁâπÊÆäÁöÑÊåâÈíÆÂíåÁªìÊûúÊòæÁ§∫
                let actionButton, resultCell;
                
                // Ê£ÄÊü•ÊòØÂê¶ÊòØÈ°πÁõÆ‰ø°ÊÅØÊ£ÄÊµãÈ°πÔºàÁ¨¨2Ë°åÔºåcheck_1_1Ôºâ
                if (item.id === 'check_1_1') {
                    // È°πÁõÆ‰ø°ÊÅØÊ£ÄÊµãÈ°πÁöÑÁâπÊÆäÂ§ÑÁêÜ
                    actionButton = `<button class="btn btn-run-check ensure-visible" onclick="startProjectInfoDetection('${item.id}')" id="btn-${item.id}">È°πÁõÆ‰ø°ÊÅØÊ£ÄÊµã</button>`;
                    resultCell = `
                        <div id="result-content-${item.id}">
                            <span class="text-muted">-</span>
                <button class="btn btn-view-result" onclick="showProjectInfoResult('${item.id}')" 
                    id="view-result-${item.id}" style="display: none; margin-top: 5px;">
                                <i class="bi bi-eye"></i> Êü•ÁúãÁªìÊûú
                            </button>
                        </div>
                    `;
                } else {
                    // ÊéàÊùÉÂßîÊâò‰π¶Ê£ÄÊµãÔºàcheck_2_2ÔºâÁªëÂÆöÂà∞ÊéàÊùÉÂßîÊâò‰π¶Â§öÊ®°ÊÄÅÊ†∏È™å API
                    if (item.id === 'check_2_2') {
                        actionButton = `<button class="btn btn-run-check ensure-visible" onclick="startAuthorizationLetterDetection('${item.id}')" id="btn-${item.id}">ÊéàÊùÉ‰π¶Ê£ÄÊµã</button>`;
                        resultCell = `
                            <div id="result-content-${item.id}">
                                <span class="text-muted">-</span>
                                <button class="btn btn-view-result" onclick="showAuthorizationLetterResult('${item.id}')" 
                                    id="view-result-${item.id}" style="display: none; margin-top: 5px;">
                                    <i class="bi bi-eye"></i> Êü•ÁúãÁªìÊûú
                                </button>
                            </div>
                        `;
                    } else {
                    // ÂÖ∂‰ªñÊ£ÄÊµãÈ°π‰øùÊåÅÂéüÊúâÈÄªËæë
                    actionButton = `
                        <button class="btn btn-run-check" onclick="startDetection('${item.id}')">
                            ÂºÄÂßãÊ£ÄÊµã
                        </button>
                    `;
                    resultCell = `
                        <span class="text-muted">-</span>
                    `;
                    }
                }
                
                const itemHtml = `
                    <tr data-id="${item.id}">
                        <td class="serial-number">${index + 1}</td>
                        <td>
                            <span class="check-category ${item.categoryClass}">
                                ${item.category}
                            </span>
                        </td>
                        <td>
                            <div class="check-title">
                                <i class="bi ${item.icon}"></i>
                                ${item.title}
                            </div>
                        </td>
                        <td>
                            <div class="check-description">
                                ${item.requirement}
                            </div>
                        </td>
                        <td>
                            <span class="status-badge status-pending" id="status-${item.id}">
                                ÂæÖÊ£ÄÊµã
                            </span>
                        </td>
                        <td>
                            ${actionButton}
                        </td>
                        <td class="result-cell" id="result-${item.id}">
                            ${resultCell}
                        </td>
                    </tr>
                `;
                violationTableBody.innerHTML += itemHtml;
            });
            
            // Ë°®Ê†ºÊ∏≤ÊüìÂÆåÊàê
        }

        // ËÆæÁΩÆ‰∫ã‰ª∂ÁõëÂê¨Âô®
        function setupEventListeners() {
            // ‰∏ÄÈîÆÊ£ÄÊµãÂÖ®ÈÉ®
            document.getElementById('checkAllBtn').addEventListener('click', function() {
                // Èò≤Ê≠¢ÈáçÂ§çÁÇπÂáª
                if (this.disabled) {
                    return;
                }
                
                this.disabled = true;
                this.innerHTML = '<i class="bi bi-hourglass spinner"></i> Ê£ÄÊµã‰∏≠...';
                
                // ÈáçÁΩÆÊâÄÊúâÊ£ÄÊµãÁªìÊûú
                window.detectionResults = {};
                
                // Ê®°ÊãüÊâπÈáèÊ£ÄÊµã
                violationItems.forEach((item, index) => {
                    setTimeout(() => {
                        startDetection(item.id);
                    }, index * 800); // ÂáèÂ∞ëÈó¥ÈöîÊó∂Èó¥ÔºåÊèêÈ´òÊïàÁéá
                });
                
                // Ê£ÄÊµãÂÆåÊàêÂêéÊÅ¢Â§çÊåâÈíÆ
                setTimeout(() => {
                    this.disabled = false;
                    this.innerHTML = '<i class="bi bi-check-all"></i> ‰∏ÄÈîÆÊ£ÄÊµãÂÖ®ÈÉ®';
                    document.getElementById('exportReportBtn').disabled = false;
                    showAIResults();
                }, violationItems.length * 800 + 2000);
            });

            // ÂØºÂá∫Êä•Âëä
            document.getElementById('exportReportBtn').addEventListener('click', function() {
                // Èò≤Ê≠¢ÈáçÂ§çÁÇπÂáª
                if (this.disabled) {
                    return;
                }
                exportDetectionReport();
            });
        }

        // ÂºÄÂßãÂçïÈ°πÊ£ÄÊµã
        function startDetection(itemId) {
            const statusElement = document.getElementById(`status-${itemId}`);
            const button = document.querySelector(`[data-id="${itemId}"] .btn-run-check`);
            
            // Èò≤Ê≠¢ÈáçÂ§çÁÇπÂáª
            if (button.disabled) {
                return;
            }
            
            // Êõ¥Êñ∞Áä∂ÊÄÅ‰∏∫Ê£ÄÊµã‰∏≠
            statusElement.className = 'status-badge status-checking';
            statusElement.innerHTML = '<i class="bi bi-hourglass spinner"></i> Ê£ÄÊµã‰∏≠...';
            button.disabled = true;
            button.innerHTML = '<i class="bi bi-hourglass spinner"></i> Ê£ÄÊµã‰∏≠...';
            
            // Ê®°ÊãüAIÊ£ÄÊµãËøáÁ®ãÔºà2-3ÁßíÔºâ
            setTimeout(() => {
                const result = simulateDetection(itemId);
                updateDetectionResult(itemId, result);
                updateProgressStats();
            }, Math.random() * 2000 + 1000); // 1-3ÁßíÈöèÊú∫Ê£ÄÊµãÊó∂Èó¥
        }

        // Ê®°ÊãüAIÊ£ÄÊµãÁªìÊûú
        function simulateDetection(itemId) {
            // Ê®°Êãü‰∏çÂêåÁöÑÊ£ÄÊµãÁªìÊûú
            const outcomes = ['compliant', 'violation', 'warning'];
            const weights = [0.6, 0.2, 0.2]; // 60%ÂêàËßÑ, 20%ËøùËßÑ, 20%Ë≠¶Âëä
            
            const random = Math.random();
            let cumulative = 0;
            
            for (let i = 0; i < outcomes.length; i++) {
                cumulative += weights[i];
                if (random <= cumulative) {
                    return {
                        status: outcomes[i],
                        confidence: Math.floor(Math.random() * 20) + 80, // 80-99%ÁΩÆ‰ø°Â∫¶
                        details: generateResultDetails(itemId, outcomes[i])
                    };
                }
            }
            
            return {
                status: 'compliant',
                confidence: 95,
                details: generateResultDetails(itemId, 'compliant')
            };
        }

        // ÁîüÊàêÊ£ÄÊµãÁªìÊûúËØ¶ÊÉÖ
        function generateResultDetails(itemId, status) {
            const item = violationItems.find(item => item.id === itemId);
            
            const details = {
                compliant: {
                    message: `${item.title}Ê£ÄÊµãÂêàËßÑ`,
                    description: 'ÁªèAIÂàÜÊûêÔºåËØ•È°πÁõÆÂÆåÂÖ®Á¨¶ÂêàÊãõÊ†áÊñá‰ª∂Ë¶ÅÊ±ÇÔºåÊó†ËøùËßÑÈ£éÈô©„ÄÇ',
                    suggestions: []
                },
                violation: {
                    message: `${item.title}Â≠òÂú®ËøùËßÑÈ£éÈô©`,
                    description: 'ÁªèAIÂàÜÊûêÔºåÂèëÁé∞ËØ•È°πÁõÆÂ≠òÂú®ÊòéÊòæËøùËßÑÈóÆÈ¢òÔºåÂèØËÉΩÂØºËá¥Â∫üÊ†á„ÄÇ',
                    suggestions: ['ËØ∑‰ªîÁªÜÊ†∏ÂØπÊãõÊ†áÊñá‰ª∂Ë¶ÅÊ±Ç', 'Âª∫ËÆÆË°•ÂÖÖÁõ∏ÂÖ≥ÊùêÊñô', 'Á°Æ‰øùÊ†ºÂºèÂÆåÂÖ®Á¨¶ÂêàË¶ÅÊ±Ç']
                },
                warning: {
                    message: `${item.title}ÈúÄË¶ÅÊ≥®ÊÑè`,
                    description: 'ÁªèAIÂàÜÊûêÔºåËØ•È°πÁõÆÂü∫Êú¨Á¨¶ÂêàË¶ÅÊ±ÇÔºå‰ΩÜÂ≠òÂú®‰∏Ä‰∫õÈúÄË¶ÅÊ≥®ÊÑèÁöÑÈóÆÈ¢ò„ÄÇ',
                    suggestions: ['Âª∫ËÆÆËøõ‰∏ÄÊ≠•Á°ÆËÆ§ÁªÜËäÇ', 'Ê†∏ÂÆûÁõ∏ÂÖ≥Ë¶ÅÊ±ÇÊòØÂê¶ÂÆåÂÖ®Êª°Ë∂≥']
                }
            };
            
            return details[status];
        }

        // Êõ¥Êñ∞Ê£ÄÊµãÁªìÊûú
        // Êõ¥Êñ∞Ê£ÄÊµãÁªìÊûú
        function updateDetectionResult(itemId, result) {
            const statusElement = document.getElementById(`status-${itemId}`);
            const resultElement = document.getElementById(`result-${itemId}`);
            const button = document.querySelector(`[data-id="${itemId}"] .btn-run-check`);
            
            // Êõ¥Êñ∞Áä∂ÊÄÅÊòæÁ§∫
            const statusConfig = {
                compliant: {
                    class: 'status-badge status-pass',
                    text: 'ÂêàËßÑ'
                },
                violation: {
                    class: 'status-badge status-fail',
                    text: 'ËøùËßÑ'
                },
                warning: {
                    class: 'status-badge status-checking',
                    text: 'Ë≠¶Âëä'
                }
            };
            
            const config = statusConfig[result.status];
            statusElement.className = config.class;
            statusElement.innerHTML = config.text;
            
            // Êõ¥Êñ∞ÁªìÊûúÂàó
            resultElement.innerHTML = `
                <div style="font-size: 0.75rem;">
                    <div style="font-weight: 600; margin-bottom: 2px;">${result.details.message}</div>
                    <div style="color: #6c757d;">ÁΩÆ‰ø°Â∫¶: ${result.confidence}%</div>
                </div>
            `;
            
            // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
            button.disabled = false;
            button.innerHTML = 'ÈáçÊñ∞Ê£ÄÊµã';
            button.className = 'btn btn-recheck ensure-visible';  // Êîπ‰∏∫Ê©ôËâ≤ÈáçÊñ∞Ê£ÄÊµãÊ†∑Âºè
            
            // Â≠òÂÇ®ÁªìÊûúÁî®‰∫éÂêéÁª≠ÊòæÁ§∫
            if (!window.detectionResults) {
                window.detectionResults = {};
            }
            window.detectionResults[itemId] = result;
        }

        // Êõ¥Êñ∞ËøõÂ∫¶ÁªüËÆ°
        function updateProgressStats() {
            const results = window.detectionResults || {};
            const total = violationItems.length;
            
            let compliant = 0, violation = 0, warning = 0;
            
            Object.values(results).forEach(result => {
                switch(result.status) {
                    case 'compliant': compliant++; break;
                    case 'violation': violation++; break;
                    case 'warning': warning++; break;
                }
            });
            
            const pending = total - (compliant + violation + warning);
            
            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('compliantCount').textContent = compliant;
            document.getElementById('warningCount').textContent = warning;
            document.getElementById('violationCount').textContent = violation;
        }

        // ÊòæÁ§∫AIÁªºÂêàÂàÜÊûêÁªìÊûú
        function showAIResults() {
            const resultsSection = document.getElementById('aiResultSection');
            const contentElement = document.getElementById('aiResultContent');
            
            const results = window.detectionResults || {};
            
            if (Object.keys(results).length === 0) {
                return;
            }
            
            // ÁªüËÆ°ÁªìÊûú
            let compliant = 0, violation = 0, warning = 0;
            Object.values(results).forEach(result => {
                switch(result.status) {
                    case 'compliant': compliant++; break;
                    case 'violation': violation++; break;
                    case 'warning': warning++; break;
                }
            });
            
            // ÁîüÊàêÁªºÂêàËØÑ‰º∞
            let overallStatus = 'compliant';
            let overallClass = 'result-compliant';
            let overallIcon = 'bi-check-circle-fill';
            let overallMessage = 'ÊäïÊ†áÊñá‰ª∂Êï¥‰ΩìÂêàËßÑ';
            
            if (violation > 0) {
                overallStatus = 'violation';
                overallClass = 'result-violation';
                overallIcon = 'bi-x-circle-fill';
                overallMessage = 'ÊäïÊ†áÊñá‰ª∂Â≠òÂú®ËøùËßÑÈ£éÈô©';
            } else if (warning > 0) {
                overallStatus = 'warning';
                overallClass = 'result-warning';
                overallIcon = 'bi-exclamation-triangle-fill';
                overallMessage = 'ÊäïÊ†áÊñá‰ª∂Âü∫Êú¨ÂêàËßÑÔºåÈúÄÊ≥®ÊÑèÁªÜËäÇ';
            }
            
            // ÁîüÊàêËØ¶ÁªÜÁªìÊûúHTML
            let detailsHtml = '';
            Object.entries(results).forEach(([itemId, result]) => {
                const item = violationItems.find(v => v.id === itemId);
                const resultClass = `result-${result.status}`;
                const resultIcon = {
                    compliant: 'bi-check-circle',
                    violation: 'bi-x-circle', 
                    warning: 'bi-exclamation-triangle'
                }[result.status];
                
                detailsHtml += `
                    <div class="result-item ${resultClass}">
                        <div class="result-title">
                            <i class="bi ${resultIcon}"></i>
                            ${item.title}
                        </div>
                        <div class="result-description">
                            ${result.details.description}
                            ${result.details.suggestions.length > 0 ? 
                                '<br><strong>Âª∫ËÆÆ:</strong> ' + result.details.suggestions.join('Ôºõ') : ''}
                        </div>
                    </div>
                `;
            });
            
            contentElement.innerHTML = `
                <div class="result-item ${overallClass}">
                    <div class="result-title">
                        <i class="bi ${overallIcon}"></i>
                        ÁªºÂêàËØÑ‰º∞ÁªìÊûú
                    </div>
                    <div class="result-description">
                        ${overallMessage}„ÄÇÂÖ±Ê£ÄÊµã ${Object.keys(results).length} È°πÔºö
                        ÂêàËßÑ ${compliant} È°πÔºåË≠¶Âëä ${warning} È°πÔºåËøùËßÑ ${violation} È°π„ÄÇ
                        ${violation > 0 ? 'Âª∫ËÆÆÈáçÁÇπÂÖ≥Ê≥®ËøùËßÑÈ°πÁõÆÔºåÂèäÊó∂‰øÆÊ≠£ÂêéÈáçÊñ∞Ê£ÄÊµã„ÄÇ' : ''}
                    </div>
                </div>
                ${detailsHtml}
            `;
            
            resultsSection.style.display = 'block';
        }

        // ÂØºÂá∫Ê£ÄÊµãÊä•Âëä
        function exportDetectionReport() {
            const results = window.detectionResults || {};
            
            if (Object.keys(results).length === 0) {
                showToast('warning', 'ËØ∑ÂÖàÂÆåÊàêÊ£ÄÊµãÂÜçÂØºÂá∫Êä•Âëä');
                return;
            }
            
            // ÊòæÁ§∫ÂØºÂá∫ËøõÂ∫¶
            const exportBtn = document.getElementById('exportReportBtn');
            const originalText = exportBtn.innerHTML;
            exportBtn.disabled = true;
            exportBtn.innerHTML = '<i class="bi bi-hourglass spinner"></i> ÁîüÊàê‰∏≠...';
            
            setTimeout(() => {
                // ÁîüÊàêÊä•ÂëäÂÜÖÂÆπ
                let reportContent = 'ÊäïÊ†áÊñá‰ª∂ÂêàËßÑÊÄßÊ£ÄÊµãÊä•Âëä\n';
                reportContent += '='*50 + '\n';
                reportContent += 'ÁîüÊàêÊó∂Èó¥Ôºö' + new Date().toLocaleString() + '\n';
                reportContent += 'Ê£ÄÊµãÂ∑•ÂÖ∑ÔºöBidAnalysis Tool\n\n';
                
                // ÁªüËÆ°ÊëòË¶Å
                let compliant = 0, violation = 0, warning = 0;
                Object.values(results).forEach(result => {
                    switch(result.status) {
                        case 'compliant': compliant++; break;
                        case 'violation': violation++; break;
                        case 'warning': warning++; break;
                    }
                });
                
                reportContent += 'Ê£ÄÊµãÊëòË¶ÅÔºö\n';
                reportContent += '-'*20 + '\n';
                reportContent += `ÊÄªÊ£ÄÊµãÈ°πÁõÆÔºö${Object.keys(results).length} È°π\n`;
                reportContent += `ÂêàËßÑÈ°πÁõÆÔºö${compliant} È°π\n`;
                reportContent += `Ë≠¶ÂëäÈ°πÁõÆÔºö${warning} È°π\n`;
                reportContent += `ËøùËßÑÈ°πÁõÆÔºö${violation} È°π\n`;
                reportContent += `ÂêàËßÑÁéáÔºö${((compliant / Object.keys(results).length) * 100).toFixed(1)}%\n\n`;
                
                // ËØ¶ÁªÜÁªìÊûú
                reportContent += 'ËØ¶ÁªÜÊ£ÄÊµãÁªìÊûúÔºö\n';
                reportContent += '-'*20 + '\n';
                Object.entries(results).forEach(([itemId, result], index) => {
                    const item = violationItems.find(v => v.id === itemId);
                    reportContent += `\n${index + 1}. ${item.title}\n`;
                    reportContent += `   Á±ªÂà´Ôºö${item.category}\n`;
                    reportContent += `   Áä∂ÊÄÅÔºö${result.status === 'compliant' ? '‚úì ÂêàËßÑ' : result.status === 'violation' ? '‚úó ËøùËßÑ' : '‚ö† Ë≠¶Âëä'}\n`;
                    reportContent += `   ÁΩÆ‰ø°Â∫¶Ôºö${result.confidence}%\n`;
                    reportContent += `   ËØ¥ÊòéÔºö${result.details.description}\n`;
                    if (result.details.suggestions.length > 0) {
                        reportContent += `   Âª∫ËÆÆÔºö${result.details.suggestions.join('Ôºõ')}\n`;
                    }
                    reportContent += '\n' + '-'*40 + '\n';
                });
                
                reportContent += '\nÊä•ÂëäÁªìÊùü\n';
                reportContent += 'Ê≥®ÔºöÊú¨Êä•ÂëäÁî±AIÊô∫ËÉΩÂàÜÊûêÁîüÊàêÔºå‰ªÖ‰æõÂèÇËÄÉÔºåËØ∑ÁªìÂêàÂÆûÈôÖÊÉÖÂÜµÂà§Êñ≠„ÄÇ';
                
                // ÂàõÂª∫‰∏ãËΩΩÈìæÊé•
                const blob = new Blob([reportContent], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ÊäïÊ†áÊñá‰ª∂ÂêàËßÑÊÄßÊ£ÄÊµãÊä•Âëä_${new Date().toISOString().slice(0, 10)}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                exportBtn.disabled = false;
                exportBtn.innerHTML = originalText;
                
                // ÊòæÁ§∫ÊàêÂäüÊèêÁ§∫
                showToast('success', 'Ê£ÄÊµãÊä•ÂëäÂ∑≤ÂØºÂá∫Âà∞‰∏ãËΩΩÊñá‰ª∂Â§π');
            }, 1500); // Ê®°ÊãüÁîüÊàêÊó∂Èó¥
        }

        // È°πÁõÆ‰ø°ÊÅØÊ£ÄÊµãÂáΩÊï∞
        async function startProjectInfoDetection(itemId) {
            const statusElement = document.getElementById(`status-${itemId}`);
            const button = document.getElementById(`btn-${itemId}`);
            const resultElement = document.getElementById(`result-${itemId}`);
            
            // Èò≤Ê≠¢ÈáçÂ§çÁÇπÂáª
            if (button.disabled) {
                return;
            }
            
            // Ëé∑ÂèñÊñá‰ª∂‰ø°ÊÅØ
            const bidFileId = sessionStorage.getItem('bidFileId');
            const tenderFileId = sessionStorage.getItem('tenderFileId');
            
            if (!bidFileId) {
                showToast('error', 'Áº∫Â∞ëÊäïÊ†áÊñá‰ª∂‰ø°ÊÅØÔºåËØ∑ËøîÂõû‰∏ªÈ°µÈáçÊñ∞‰∏ä‰º†Êñá‰ª∂');
                return;
            }
            
            // Êõ¥Êñ∞Áä∂ÊÄÅ‰∏∫Ê£ÄÊµã‰∏≠
            statusElement.className = 'status-badge status-checking';
            statusElement.innerHTML = '<i class="bi bi-hourglass spinner"></i> Ê£ÄÊµã‰∏≠...';
            button.disabled = true;
            button.innerHTML = '<i class="bi bi-hourglass spinner"></i> Ê£ÄÊµã‰∏≠...';
            
            try {
                // Ë∞ÉÁî®È°πÁõÆ‰ø°ÊÅØÊ£ÄÊµãAPI
                const response = await fetch('/api/check-project-info', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        bid_file_id: bidFileId,
                        tender_file_id: tenderFileId,
                        check_type: 'project_info'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Â≠òÂÇ®Ê£ÄÊµãÁªìÊûú
                    if (!window.projectInfoResults) {
                        window.projectInfoResults = {};
                    }
                    window.projectInfoResults[itemId] = result.data;
                    
                    // Êõ¥Êñ∞Áä∂ÊÄÅÊòæÁ§∫
                    updateProjectInfoResult(itemId, result.data);
                } else {
                    throw new Error(result.error || 'Ê£ÄÊµãÂ§±Ë¥•');
                }
                
            } catch (error) {
                console.error('È°πÁõÆ‰ø°ÊÅØÊ£ÄÊµãÂ§±Ë¥•:', error);
                
                // ÊÅ¢Â§çÁä∂ÊÄÅ
                statusElement.className = 'status-badge status-pending';
                statusElement.innerHTML = 'ÂæÖÊ£ÄÊµã';
                button.disabled = false;
                button.innerHTML = 'È°πÁõÆ‰ø°ÊÅØÊ£ÄÊµã';
                
                showToast('error', 'Ê£ÄÊµãÂ§±Ë¥•: ' + error.message);
            }
        }

        // ÊéàÊùÉÂßîÊâò‰π¶Ê£ÄÊµã
        async function startAuthorizationLetterDetection(itemId) {
            const statusElement = document.getElementById(`status-${itemId}`);
            // Âéü‰ª£Á†Å‰∏≠‰ΩøÁî®‰∫ÜÊú™ÂÆö‰πâÁöÑ item ÂØºËá¥ button ‰∏∫Á©∫ÔºåËøôÈáåÁªü‰∏Ä‰ΩøÁî® itemId
            const button = document.getElementById(`btn-${itemId}`);
            const resultElement = document.getElementById(`result-${itemId}`);

            if (!statusElement) {
                console.warn('ÊéàÊùÉÂßîÊâò‰π¶Ê£ÄÊµã: Êú™ÊâæÂà∞Áä∂ÊÄÅÂÖÉÁ¥† status-' + itemId);
                return;
            }

            if (button && button.disabled) return;

            const bidFileId = sessionStorage.getItem('bidFileId');
            const tenderFileId = sessionStorage.getItem('tenderFileId');
            if (!bidFileId) {
                showToast('error', 'Áº∫Â∞ëÊäïÊ†áÊñá‰ª∂‰ø°ÊÅØÔºåËØ∑ËøîÂõû‰∏ªÈ°µÈáçÊñ∞‰∏ä‰º†Êñá‰ª∂');
                return;
            }

            statusElement.className = 'status-badge status-checking';
            statusElement.innerHTML = '<i class="bi bi-hourglass spinner"></i> Ê£ÄÊµã‰∏≠...';
            if (button) {
                button.disabled = true;
                button.innerHTML = '<i class="bi bi-hourglass spinner"></i> Ê£ÄÊµã‰∏≠...';
            }

            try {
                const response = await fetch('/api/analyze/authorization-letter', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        file_id: bidFileId,
                        tender_file_id: tenderFileId || null,
                        auto_select: true
                    })
                });
                const result = await response.json();
                if (!result.success) throw new Error(result.error || 'Ê†∏È™åÂ§±Ë¥•');

                if (!window.authorizationLetterResults) window.authorizationLetterResults = {};
                window.authorizationLetterResults[itemId] = result.data;
                updateAuthorizationLetterResult(itemId, result.data);
            } catch (err) {
                console.error('ÊéàÊùÉÂßîÊâò‰π¶Ê£ÄÊµãÂ§±Ë¥•:', err);
                statusElement.className = 'status-badge status-pending';
                statusElement.innerHTML = 'ÂæÖÊ£ÄÊµã';
                if (button) {
                    button.disabled = false;
                    button.innerHTML = 'ÊéàÊùÉ‰π¶Ê£ÄÊµã';
                }
                showToast('error', 'ÊéàÊùÉÂßîÊâò‰π¶Ê£ÄÊµãÂ§±Ë¥•: ' + err.message);
            }
        }

        function updateAuthorizationLetterResult(itemId, data) {
            const statusElement = document.getElementById(`status-${itemId}`);
            const button = document.getElementById(`btn-${itemId}`);
            const resultElement = document.getElementById(`result-${itemId}`);

            let statusClass = 'status-badge status-pass';
            let statusText = 'ÂêàËßÑ';
            let missingAuth = false;
            if (data && data.parsed_result) {
                const issues = data.parsed_result.issues || [];
                // Âà§Êñ≠ÊòØÂê¶‰∏∫‚ÄúÊú™ÊâæÂà∞ÊéàÊùÉÂßîÊâò‰π¶‚ÄùÁâπÊÆäÁº∫Â§±ÊèêÁ§∫
                const missingIssue = issues.find(it => (it.type && it.type.includes('Áº∫Â§±')) || (it.description && it.description.includes('Êú™ÊâæÂà∞ÊéàÊùÉÂßîÊâò‰π¶')));
                if (missingIssue && (!data.selected_file)) {
                    statusClass = 'status-badge status-checking'; // ÈªÑËâ≤Ë≠¶ÂëäÊ†∑Âºè
                    statusText = 'Êú™ÊâæÂà∞ÊéàÊùÉÂßîÊâò‰π¶';
                    missingAuth = true;
                } else if (issues.length > 0) {
                    statusClass = 'status-badge status-fail';
                    statusText = 'ÈóÆÈ¢ò';
                } else if (data.project_id_match === false || data.project_name_match === false) {
                    statusClass = 'status-badge status-checking';
                    statusText = 'Ë≠¶Âëä';
                }
            }

            statusElement.className = statusClass;
            statusElement.innerHTML = statusText;

            const issuesCount = (data && data.parsed_result && (data.parsed_result.issues || []).length) || 0;
            resultElement.innerHTML = `
                <div style="font-size:0.75rem;">
                    <div style="font-weight:600;">${missingAuth ? 'Êú™ÊâæÂà∞ÊéàÊùÉÂßîÊâò‰π¶' : (issuesCount>0? 'ÂèëÁé∞ÈóÆÈ¢ò':'Ê£ÄÊµãÂÆåÊàê')}</div>
                    <div style="color:#6c757d;">${missingAuth ? 'ÊèêÁ§∫: ËØ∑Á°ÆËÆ§ÊñáÊ°£ÊòØÂê¶ÈÅóÊºè' : ('ÈóÆÈ¢òÊï∞: ' + issuesCount)}</div>
                </div>
                <button class="btn btn-view-result" onclick="showAuthorizationLetterResult('${itemId}')" id="view-result-${itemId}" style="margin-top:5px;">
                    <i class="bi bi-eye"></i> Êü•ÁúãÁªìÊûú
                </button>
            `;

            if (button) {
                button.disabled = false;
                button.innerHTML = missingAuth ? 'ÈáçÊñ∞Ê£ÄÊµã' : 'ÈáçÊñ∞Ê£ÄÊµã';
                button.className = 'btn btn-recheck ensure-visible';
            }
            updateProgressStats();
        }

        function showAuthorizationLetterResult(itemId) {
            const data = window.authorizationLetterResults && window.authorizationLetterResults[itemId];
            if (!data) { showToast('warning','Êó†Ê£ÄÊµãÁªìÊûú'); return; }
            const parsed = data.parsed_result || {};
            const issues = parsed.issues || [];
            const rep = parsed.legal_representative || {};
            const auth = parsed.authorization || {};
            const pc = parsed.project_check || {};
            const summary = parsed.summary || data.parsed_error || 'Êó†Ê¶ÇË¶Å';

            let issuesHtml = 'Êó†ÈóÆÈ¢ò';
            if (issues.length>0) {
                issuesHtml = issues.map((it,i)=>`<div style='background:#f8f9fa;border-left:4px solid #dc3545;padding:8px 10px;margin-bottom:6px;border-radius:0 4px 4px 0;'>
                    <div style='font-weight:600;color:#dc3545;'>${i+1}. ${it.type||'ÈóÆÈ¢ò'}</div>
                    <div style='font-size:0.8rem;color:#555;'>${it.description||''}</div>
                    <div style='font-size:0.75rem;color:#888;'>‰∏•ÈáçÁ®ãÂ∫¶: ${it.severity||'Êú™Áü•'}</div>
                </div>`).join('');
            }

            const modal = document.createElement('div');
            modal.style.cssText = `position:fixed;inset:0;z-index:10000;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;`;
            modal.innerHTML = `
                <div style='background:#fff;max-width:780px;width:92%;max-height:85vh;overflow:auto;padding:24px;border-radius:14px;box-shadow:0 8px 30px rgba(0,0,0,.25);'>
                  <div style='display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;border-bottom:2px solid #0d6efd;padding-bottom:8px;'>
                    <h5 style='margin:0;color:#0d6efd;'><i class="bi bi-person-check"></i> ÊéàÊùÉÂßîÊâò‰π¶Ê†∏È™åÁªìÊûú</h5>
                    <button style='background:none;border:none;font-size:1.4rem;color:#666;cursor:pointer;' onclick='this.closest(".auth-modal-root").remove()'>&times;</button>
                  </div>
                  <div style='display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-bottom:16px;'>
                    <div style='background:#f1f5f9;padding:10px 12px;border-radius:8px;'>
                       <div style='font-weight:600;margin-bottom:4px;'>Ê≥ïÂÆö‰ª£Ë°®‰∫∫</div>
                       <div style='font-size:.8rem;color:#555;'>ÂßìÂêç: ${rep.name||'-'}</div>
                       <div style='font-size:.8rem;color:#555;'>ËØÅ‰ª∂Âè∑: ${rep.id_number||'-'}</div>
                       <div style='font-size:.7rem;color:#666;'>ÊúâÊïàÊÄß: ${(rep.validity&&rep.validity.is_valid)?'‚úÖ':'‚ùì'} ${rep.validity&&rep.validity.valid_until? 'Ëá≥ '+rep.validity.valid_until : ''}</div>
                    </div>
                    <div style='background:#f1f5f9;padding:10px 12px;border-radius:8px;'>
                       <div style='font-weight:600;margin-bottom:4px;'>ÊéàÊùÉ‰ø°ÊÅØ</div>
                       <div style='font-size:.8rem;color:#555;'>Ë¢´ÊéàÊùÉ‰∫∫: ${auth.delegate_name||'-'}</div>
                       <div style='font-size:.8rem;color:#555;'>ËØÅ‰ª∂Âè∑: ${auth.delegate_id_number||'-'}</div>
                       <div style='font-size:.7rem;color:#666;'>ÂÆåÊï¥ÊÄß: ${auth.completeness||'-'}</div>
                    </div>
                    <div style='background:#f1f5f9;padding:10px 12px;border-radius:8px;'>
                       <div style='font-weight:600;margin-bottom:4px;'>È°πÁõÆÂåπÈÖç</div>
                       <div style='font-size:.75rem;color:#555;'>ÊúüÊúõÁºñÂè∑: ${pc.expected_project_id||data.expected_project_id||'-'}</div>
                       <div style='font-size:.75rem;color:#555;'>ËØÜÂà´ÁºñÂè∑: ${pc.found_project_id||data.effective_found_project_id||'-'}</div>
                       <div style='font-size:.75rem;color:#555;'>ÁºñÂè∑ÂåπÈÖç: ${(pc.project_id_match ?? data.project_id_match)===true?'‚úÖ':'‚ö†'}</div>
                       <hr style='margin:6px 0;'>
                       <div style='font-size:.75rem;color:#555;'>ÊúüÊúõÂêçÁß∞: ${pc.expected_project_name||data.expected_project_name||'-'}</div>
                       <div style='font-size:.75rem;color:#555;'>ËØÜÂà´ÂêçÁß∞: ${pc.found_project_name||data.effective_found_project_name||'-'}</div>
                       <div style='font-size:.75rem;color:#555;'>ÂêçÁß∞ÂåπÈÖç: ${(pc.project_name_match ?? data.project_name_match)===true?'‚úÖ':'‚ö†'}</div>
                    </div>
                  </div>
                                    <div style='background:#f1f5f9;padding:8px 12px;border-radius:8px;margin-bottom:12px;font-size:.7rem;color:#444;'>
                                        <strong>Êñá‰ª∂ÈÄâÊã©:</strong> ${(data.selection_meta && data.selection_meta.chosen_name) ? data.selection_meta.chosen_name : (data.selected_file ? data.selected_file.split(/[/\\]/).pop() : 'ÂéüÂßã‰∏ä‰º†Êñá‰ª∂')} | Á≠ñÁï•: ${(data.selection_meta && data.selection_meta.strategy) || 'original'}
                                    </div>
                  <div style='margin-bottom:14px;'>
                    <h6 style='margin:0 0 6px;font-weight:600;'>ÈóÆÈ¢òÂàóË°®</h6>
                    ${issuesHtml}
                  </div>
                  <div style='background:#fafafa;border-left:4px solid #0d6efd;padding:10px 12px;border-radius:4px;margin-bottom:18px;font-size:.8rem;color:#333;'>
                    <strong>ÊëòË¶Å:</strong> ${summary}
                  </div>
                  <div style='text-align:right;'>
                    <button onclick='this.closest(".auth-modal-root").remove()' style='background:#0d6efd;border:none;color:#fff;padding:8px 18px;border-radius:6px;cursor:pointer;'>ÂÖ≥Èó≠</button>
                  </div>
                </div>`;
            modal.className = 'auth-modal-root';
            modal.addEventListener('click', e=>{ if(e.target===modal) modal.remove(); });
            document.body.appendChild(modal);
        }

        // Êõ¥Êñ∞È°πÁõÆ‰ø°ÊÅØÊ£ÄÊµãÁªìÊûúÊòæÁ§∫
        function updateProjectInfoResult(itemId, result) {
            const statusElement = document.getElementById(`status-${itemId}`);
            const button = document.getElementById(`btn-${itemId}`);
            const resultElement = document.getElementById(`result-${itemId}`);
            const viewButton = document.getElementById(`view-result-${itemId}`);
            
            // Ê†πÊçÆÊ£ÄÊµãÁªìÊûúÊõ¥Êñ∞Áä∂ÊÄÅ
            let statusClass, statusText;
            
            if (result.has_errors && result.error_count > 0) {
                statusClass = 'status-badge status-fail';
                statusText = 'ËøùËßÑ';
            } else if (result.confidence && result.confidence < 0.8) {
                statusClass = 'status-badge status-checking';
                statusText = 'Ë≠¶Âëä';
            } else {
                statusClass = 'status-badge status-pass';
                statusText = 'ÂêàËßÑ';
            }
            
            statusElement.className = statusClass;
            statusElement.innerHTML = statusText;
            
            // Êõ¥Êñ∞ÁªìÊûúÊòæÁ§∫
            resultElement.innerHTML = `
                <div style="font-size: 0.75rem;">
                    <div style="font-weight: 600; margin-bottom: 2px;">
                        ${result.has_errors ? 'ÂèëÁé∞ÈóÆÈ¢ò' : 'Ê£ÄÊµãÂÆåÊàê'}
                    </div>
                    <div style="color: #6c757d;">
                        ÈîôËØØÊï∞: ${result.error_count || 0}
                    </div>
                </div>
        <button class="btn btn-view-result" onclick="showProjectInfoResult('${itemId}')" 
            id="view-result-${itemId}" style="margin-top: 5px;">
                    <i class="bi bi-eye"></i> Êü•ÁúãÁªìÊûú
                </button>
            `;
            
            // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
            button.disabled = false;
            button.innerHTML = 'ÈáçÊñ∞Ê£ÄÊµã';
            button.className = 'btn btn-recheck ensure-visible';  // Êîπ‰∏∫Ê©ôËâ≤ÈáçÊñ∞Ê£ÄÊµãÊ†∑Âºè
            
            // Êõ¥Êñ∞ËøõÂ∫¶ÁªüËÆ°
            updateProgressStats();
        }

        // ÊòæÁ§∫È°πÁõÆ‰ø°ÊÅØÊ£ÄÊµãÁªìÊûúÁöÑÊµÆÁ™ó
        function showProjectInfoResult(itemId) {
            const result = window.projectInfoResults && window.projectInfoResults[itemId];
            
            if (!result) {
                showToast('warning', 'Êú™ÊâæÂà∞Ê£ÄÊµãÁªìÊûú');
                return;
            }
            
            // ÂàõÂª∫Ê®°ÊÄÅÊ°Ü
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 9999;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.3s ease;
            `;
            
            // ÁîüÊàêÈîôËØØËØ¶ÊÉÖHTML
            let errorDetailsHtml = '';
            if (result.errors && result.errors.length > 0) {
                errorDetailsHtml = `
                    <div style="margin-top: 20px;">
                        <h6 style="color: #dc3545; margin-bottom: 15px;">
                            <i class="bi bi-exclamation-triangle"></i> ÂèëÁé∞ÁöÑÈóÆÈ¢òÔºö
                        </h6>
                        <div style="max-height: 300px; overflow-y: auto;">
                `;
                
                result.errors.forEach((error, index) => {
                    errorDetailsHtml += `
                        <div style="background: #f8f9fa; border-left: 4px solid #dc3545; 
                                   padding: 12px; margin-bottom: 10px; border-radius: 0 5px 5px 0;">
                            <div style="font-weight: 600; color: #dc3545; margin-bottom: 5px;">
                                ÈóÆÈ¢ò ${index + 1}: ${error.type === 'wrong_project_id' ? 'È°πÁõÆÁºñÂè∑ÈîôËØØ' : 'È°πÁõÆ‰ø°ÊÅØÈîôËØØ'}
                            </div>
                            <div style="font-size: 0.9rem; margin-bottom: 5px;">
                                <strong>ÂèëÁé∞ÂÄºÔºö</strong> ${error.found_value}
                            </div>
                            <div style="font-size: 0.9rem; margin-bottom: 5px;">
                                <strong>Ê≠£Á°ÆÂÄºÔºö</strong> ${error.correct_value}
                            </div>
                            <div style="font-size: 0.9rem; margin-bottom: 5px;">
                                <strong>‰∏•ÈáçÁ®ãÂ∫¶Ôºö</strong> 
                                <span style="color: ${error.severity === 'È´ò' ? '#dc3545' : '#ffc107'};">${error.severity}</span>
                            </div>
                            <div style="font-size: 0.9rem; color: #6c757d;">
                                <strong>ËØ¥ÊòéÔºö</strong> ${error.description}
                            </div>
                        </div>
                    `;
                });
                
                errorDetailsHtml += `
                        </div>
                    </div>
                `;
            }
            
            // ÊÄª‰ΩìÁä∂ÊÄÅ
            const overallStatus = result.has_errors ? 
                '<span style="color: #dc3545;"><i class="bi bi-x-circle"></i> ‰∏çÂêàËßÑ</span>' :
                '<span style="color: #28a745;"><i class="bi bi-check-circle"></i> ÂêàËßÑ</span>';
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 12px; padding: 25px; 
                           max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;
                           box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; 
                               margin-bottom: 20px; border-bottom: 2px solid #007bff; padding-bottom: 15px;">
                        <h5 style="margin: 0; color: #007bff;">
                            <i class="bi bi-clipboard-check"></i> È°πÁõÆ‰ø°ÊÅØÊ£ÄÊµãÁªìÊûú
                        </h5>
                        <button onclick="this.closest('.modal').remove()" 
                                style="background: none; border: none; font-size: 1.5rem; color: #6c757d; cursor: pointer;">
                            <i class="bi bi-x"></i>
                        </button>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong>ÊÄª‰ΩìÁä∂ÊÄÅÔºö</strong> ${overallStatus}
                                </div>
                                <div style="font-size: 0.9rem; color: #6c757d;">
                                    Ê£ÄÊµãÊó∂Èó¥Ôºö${new Date().toLocaleString()}
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div style="background: #e3f2fd; padding: 12px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #1976d2; margin-bottom: 5px;">
                                    ${result.error_count || 0}
                                </div>
                                <div style="font-size: 0.9rem; color: #1976d2;">ÂèëÁé∞ÈóÆÈ¢ò</div>
                            </div>
                            <div style="background: #e8f5e8; padding: 12px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #388e3c; margin-bottom: 5px;">
                                    ${Math.round((result.confidence || 0.8) * 100)}%
                                </div>
                                <div style="font-size: 0.9rem; color: #388e3c;">Ê£ÄÊµãÁΩÆ‰ø°Â∫¶</div>
                            </div>
                        </div>
                    </div>
                    
                    ${errorDetailsHtml}
                    
                    <div style="margin-top: 25px; text-align: right; border-top: 1px solid #dee2e6; padding-top: 15px;">
                        <button onclick="this.closest('.modal').remove()" 
                                style="background: #007bff; color: white; border: none; padding: 8px 20px; 
                                       border-radius: 6px; cursor: pointer;">
                            ÂÖ≥Èó≠
                        </button>
                    </div>
                </div>
            `;
            
            modal.className = 'modal';
            document.body.appendChild(modal);
            
            // ÁÇπÂáªËÉåÊôØÂÖ≥Èó≠
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // ÊòæÁ§∫ÊèêÁ§∫Ê∂àÊÅØ
        function showToast(type, message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                padding: 12px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 9999;
                max-width: 300px;
                word-wrap: break-word;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                animation: slideIn 0.3s ease-out;
            `;
            
            const icons = {
                success: 'bi-check-circle',
                warning: 'bi-exclamation-triangle',
                error: 'bi-x-circle'
            };
            
            const colors = {
                success: 'linear-gradient(135deg, #10b981, #059669)',
                warning: 'linear-gradient(135deg, #f59e0b, #d97706)',
                error: 'linear-gradient(135deg, #ef4444, #dc2626)'
            };
            
            toast.style.background = colors[type] || colors.success;
            toast.innerHTML = `<i class="bi ${icons[type] || icons.success}"></i> ${message}`;
            
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), type === 'error' ? 5000 : 3000);
        }

        // ‰∏ªÈ¢òÂàáÊç¢ÂäüËÉΩ
        function initThemeSwitcher() {
            const themeToggle = document.getElementById('themeToggle');
            const themeDropdown = document.getElementById('themeDropdown');
            const themeItems = document.querySelectorAll('.theme-item');
            const savedTheme = localStorage.getItem('bidAnalysisTheme') || 'default';
            
            // Â∫îÁî®‰øùÂ≠òÁöÑ‰∏ªÈ¢ò
            if (savedTheme !== 'default') {
                document.documentElement.setAttribute('data-theme', savedTheme);
            }
            
            // Êõ¥Êñ∞ÊøÄÊ¥ªÁä∂ÊÄÅ
            themeItems.forEach(item => {
                item.classList.remove('active');
                if (item.dataset.theme === savedTheme) {
                    item.classList.add('active');
                }
            });
            
            // ‰∏ªÈ¢ò‰∏ãÊãâÊ°ÜÂàáÊç¢
            themeToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                themeDropdown.classList.toggle('show');
            });
            
            // ÁÇπÂáªÂ§ñÈÉ®ÂÖ≥Èó≠‰∏ãÊãâÊ°Ü
            document.addEventListener('click', () => {
                themeDropdown.classList.remove('show');
            });
            
            // Èò≤Ê≠¢ÁÇπÂáª‰∏ãÊãâÊ°ÜÂÜÖÈÉ®Êó∂ÂÖ≥Èó≠
            themeDropdown.addEventListener('click', (e) => {
                e.stopPropagation();
            });
            
            // ‰∏ªÈ¢òÈÄâÊã©
            themeItems.forEach(item => {
                item.addEventListener('click', () => {
                    const theme = item.dataset.theme;
                    
                    // ÁßªÈô§ÊâÄÊúâÊøÄÊ¥ªÁä∂ÊÄÅ
                    themeItems.forEach(i => i.classList.remove('active'));
                    
                    // Ê∑ªÂä†ÂΩìÂâçÊøÄÊ¥ªÁä∂ÊÄÅ
                    item.classList.add('active');
                    
                    // Â∫îÁî®‰∏ªÈ¢ò
                    if (theme === 'default') {
                        document.documentElement.removeAttribute('data-theme');
                    } else {
                        document.documentElement.setAttribute('data-theme', theme);
                    }
                    
                    // ‰øùÂ≠ò‰∏ªÈ¢òËÆæÁΩÆ
                    localStorage.setItem('bidAnalysisTheme', theme);
                    
                    // ÂÖ≥Èó≠‰∏ãÊãâÊ°Ü
                    themeDropdown.classList.remove('show');
                    
                    // Ê∑ªÂä†ÂàáÊç¢Âä®ÁîªÊïàÊûú
                    document.body.style.transition = 'all 0.3s ease';
                    setTimeout(() => {
                        document.body.style.transition = '';
                    }, 300);
                });
            });
        }
    </script>
    
    <!-- È°µËÑö‰ø°ÊÅØ -->
    <div class="page-footer">
        Âü∫‰∫éÂèÇËÄÉÊ†áÂáÜÁöÑÈÄêÈ°πÂêàËßÑÊÄßÊ£ÄÊü• | Êô∫ËÉΩËØÜÂà´Â∫üÊ†áÈ£éÈô©ÁÇπ | Êèê‰æõ‰∏ì‰∏öÊîπËøõÂª∫ËÆÆ
    </div>
</body>

</html>
